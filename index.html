<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>PuppyPost</title>
<script src="https://telegram.org/js/telegram-web-app.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Nunito:wght@500;600;700;800;900&display=swap" rel="stylesheet">
<style>
:root{
  --bg:#E8E8E8;--acc:#FF5722;--acc2:#FF7043;--dk:#2C2C2C;--gr:#888;--lg:#bbb;
  --gn:#4CAF50;--yl:#FFC107;--rd:#F44336;--bl:#2196F3;--pu:#9C27B0;
  --sl:-6px -6px 14px rgba(255,255,255,.85);--sd:6px 6px 14px rgba(0,0,0,.13);
  --sh:var(--sl),var(--sd);--il:inset -4px -4px 8px rgba(255,255,255,.8);
  --id:inset 4px 4px 8px rgba(0,0,0,.1);--ins:var(--il),var(--id);
  --r:20px;--rs:14px;--rp:50px
}
@keyframes pulse-dot{0%,100%{transform:scale(1);opacity:1}50%{transform:scale(1.4);opacity:.7}}
@keyframes bounce-in{0%{transform:scale(0);opacity:0}60%{transform:scale(1.15)}80%{transform:scale(.95)}100%{transform:scale(1);opacity:1}}
@keyframes slide-up{from{opacity:0;transform:translateY(18px)}to{opacity:1;transform:translateY(0)}}
@keyframes heart-pop{0%{transform:scale(1)}30%{transform:scale(1.4)}60%{transform:scale(.9)}100%{transform:scale(1)}}
@keyframes shimmer{0%{background-position:-200% 0}100%{background-position:200% 0}}
@keyframes toast-in{0%{transform:translateX(-50%) translateY(14px) scale(.9);opacity:0}100%{transform:translateX(-50%) translateY(0) scale(1);opacity:1}}
@keyframes float{0%,100%{transform:translateY(0)}50%{transform:translateY(-5px)}}
@keyframes notif-slide{from{transform:translateX(110%);opacity:0}to{transform:translateX(0);opacity:1}}
@keyframes fadeIn{from{opacity:0}to{opacity:1}}
@keyframes screen-in{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:translateY(0)}}
@keyframes modal-in{from{opacity:0;transform:translateY(30px)}to{opacity:1;transform:translateY(0)}}
*{margin:0;padding:0;box-sizing:border-box;-webkit-tap-highlight-color:transparent}
body{font-family:'Nunito',sans-serif;background:var(--bg);min-height:100vh;overflow-x:hidden;color:var(--dk)}
::-webkit-scrollbar{width:0}
.screen{display:none;min-height:100vh;padding-bottom:90px;animation:screen-in .22s ease}
.screen.active{display:block}
.hdr{position:sticky;top:0;z-index:100;background:var(--bg);padding:14px 18px 10px;display:flex;align-items:center;gap:10px}
.hdr-logo{display:flex;align-items:center;gap:10px;flex:1}
.logo-ic{width:40px;height:40px;background:var(--bg);border-radius:12px;display:flex;align-items:center;justify-content:center;box-shadow:var(--sh);font-size:18px;animation:float 3s ease-in-out infinite}
.logo-nm{font-size:20px;font-weight:900;color:var(--dk)}
.logo-nm span{color:var(--acc)}
.hbtn{width:40px;height:40px;background:var(--bg);border-radius:12px;border:none;display:flex;align-items:center;justify-content:center;box-shadow:var(--sh);cursor:pointer;transition:all .2s;position:relative;font-family:'Nunito',sans-serif;color:var(--gr);flex-shrink:0}
.hbtn:active{box-shadow:var(--ins);transform:scale(.95)}
.bb{width:38px;height:38px;background:var(--bg);border-radius:12px;border:none;display:flex;align-items:center;justify-content:center;box-shadow:var(--sh);cursor:pointer;transition:all .2s;color:var(--gr);flex-shrink:0}
.bb:active{box-shadow:var(--ins);transform:scale(.95)}
.bnav{position:fixed;bottom:0;left:0;right:0;z-index:200;background:var(--bg);padding:8px 6px 18px;display:flex;align-items:center;justify-content:space-around;box-shadow:0 -6px 24px rgba(0,0,0,.07);border-radius:26px 26px 0 0}
.ni{display:flex;flex-direction:column;align-items:center;gap:3px;padding:7px 10px;border-radius:var(--rs);cursor:pointer;transition:all .2s;flex:1;background:transparent;border:none}
.ni .ic{display:flex;align-items:center;justify-content:center;width:24px;height:24px;transition:transform .2s;color:var(--lg);position:relative}
.ni .lb{font-size:10px;font-weight:700;color:var(--lg);transition:color .2s;font-family:'Nunito',sans-serif}
.ni.active{background:var(--bg);box-shadow:var(--sh)}
.ni.active .lb{color:var(--acc)}
.ni.active .ic{transform:scale(1.15);color:var(--acc)}
.ni.active .ic svg{animation:bounce-in .3s ease forwards}
.nbadge{position:absolute;top:-4px;right:-6px;min-width:16px;height:16px;background:var(--acc);border-radius:8px;font-size:9px;font-weight:900;color:#fff;display:flex;align-items:center;justify-content:center;padding:0 3px}
.card{background:var(--bg);border-radius:var(--r);box-shadow:var(--sh);padding:18px}
.ci{background:var(--bg);border-radius:var(--r);box-shadow:var(--ins);padding:14px}
.btn{width:100%;padding:15px;border:none;border-radius:var(--rp);font-size:15px;font-weight:800;cursor:pointer;transition:all .2s;font-family:'Nunito',sans-serif;display:flex;align-items:center;justify-content:center;gap:8px}
.ba{background:linear-gradient(135deg,var(--acc),var(--acc2));color:#fff;box-shadow:0 8px 20px rgba(255,87,34,.3)}
.ba:active{transform:scale(.97);box-shadow:0 4px 12px rgba(255,87,34,.2)}
.bn{background:var(--bg);color:var(--acc);box-shadow:var(--sh)}
.bn:active{box-shadow:var(--ins);transform:scale(.97)}
.bg{background:var(--bg);color:var(--gr);box-shadow:var(--sh)}
.bg:active{box-shadow:var(--ins);transform:scale(.97)}
.inp{width:100%;padding:13px 16px;background:var(--bg);border:none;border-radius:var(--r);box-shadow:var(--ins);font-size:15px;font-weight:600;color:var(--dk);font-family:'Nunito',sans-serif;outline:none}
.inp::placeholder{color:var(--lg)}
.txta{width:100%;padding:13px 16px;background:var(--bg);border:none;border-radius:var(--r);box-shadow:var(--ins);font-size:14px;font-weight:600;color:var(--dk);font-family:'Nunito',sans-serif;outline:none;resize:none;min-height:88px}
.flb{font-size:12px;font-weight:800;color:var(--gr);text-transform:uppercase;letter-spacing:.5px;margin-bottom:7px;display:block}
.fgr{margin-bottom:18px}
.pc{padding:0 18px}
.stl{font-size:20px;font-weight:900;color:var(--dk);margin-bottom:14px;padding:0 18px}
.sinp{width:100%;padding:13px 16px 13px 44px;background:var(--bg);border:none;border-radius:var(--rp);box-shadow:var(--ins);font-size:15px;font-weight:600;color:var(--dk);font-family:'Nunito',sans-serif;outline:none}
.sinp::placeholder{color:var(--lg)}
.csc{display:flex;gap:8px;padding:0 18px 18px;overflow-x:auto;scrollbar-width:none}
.cc{flex-shrink:0;padding:9px 16px;background:var(--bg);border-radius:var(--rp);box-shadow:var(--sh);font-size:13px;font-weight:700;color:var(--gr);cursor:pointer;transition:all .2s;border:none;font-family:'Nunito',sans-serif;white-space:nowrap}
.cc.active{background:linear-gradient(135deg,var(--acc),var(--acc2));color:#fff;box-shadow:0 6px 14px rgba(255,87,34,.3)}
.chrow{display:flex;gap:8px;flex-wrap:wrap}
.ch{flex-shrink:0;padding:8px 14px;background:var(--bg);border-radius:var(--rp);box-shadow:var(--sh);font-size:13px;font-weight:700;color:var(--gr);cursor:pointer;transition:all .2s;border:none;font-family:'Nunito',sans-serif}
.ch.active{background:linear-gradient(135deg,var(--acc),var(--acc2));color:#fff;box-shadow:0 5px 12px rgba(255,87,34,.28)}
.acard{background:var(--bg);border-radius:var(--r);box-shadow:var(--sh);overflow:hidden;margin-bottom:14px;cursor:pointer;transition:all .22s cubic-bezier(.34,1.56,.64,1)}
.acard:active{transform:scale(.97) translateY(2px)}
.acard:nth-child(1){animation:slide-up .28s ease .04s both}
.acard:nth-child(2){animation:slide-up .28s ease .08s both}
.acard:nth-child(3){animation:slide-up .28s ease .12s both}
.acard:nth-child(4){animation:slide-up .28s ease .16s both}
.acard:nth-child(5){animation:slide-up .28s ease .20s both}
.acard:nth-child(6){animation:slide-up .28s ease .24s both}
.aimg{width:100%;height:170px;background:linear-gradient(135deg,#ddd,#c8c8c8);display:flex;align-items:center;justify-content:center;font-size:54px;position:relative;overflow:hidden}
.aimg img{width:100%;height:100%;object-fit:cover}
.pinb{position:absolute;top:10px;left:10px;background:var(--dk);color:#fff;font-size:10px;font-weight:800;padding:4px 10px;border-radius:20px}
.newb{position:absolute;top:10px;right:10px;background:var(--gn);color:#fff;font-size:9px;font-weight:800;padding:3px 8px;border-radius:20px}
.ab{padding:14px}
.acat{font-size:11px;font-weight:800;color:var(--acc);text-transform:uppercase;letter-spacing:.5px;margin-bottom:4px}
.atl{font-size:16px;font-weight:800;color:var(--dk);margin-bottom:7px;line-height:1.3}
.ame{display:flex;align-items:center;justify-content:space-between}
.apr{font-size:21px;font-weight:900;color:var(--acc)}
.ain{font-size:12px;font-weight:600;color:var(--gr)}
.ata{display:flex;gap:6px;margin-top:8px;flex-wrap:wrap}
.tag{padding:3px 9px;background:var(--bg);border-radius:18px;font-size:11px;font-weight:700;color:var(--gr);box-shadow:var(--sh)}
.hsc{display:flex;gap:12px;padding:0 18px 4px;overflow-x:auto;scrollbar-width:none}
.hac{flex-shrink:0;width:190px;background:var(--bg);border-radius:var(--r);box-shadow:var(--sh);overflow:hidden;cursor:pointer;transition:all .22s cubic-bezier(.34,1.56,.64,1)}
.hac:active{transform:scale(.97)}
.hai{height:120px;background:linear-gradient(135deg,#ddd,#c8c8c8);display:flex;align-items:center;justify-content:center;font-size:38px;overflow:hidden}
.hai img{width:100%;height:100%;object-fit:cover}
.hab{padding:10px}
.hat{font-size:13px;font-weight:800;color:var(--dk);margin-bottom:3px;line-height:1.2}
.hap{font-size:15px;font-weight:900;color:var(--acc)}
.mac{background:var(--bg);border-radius:var(--r);box-shadow:var(--sh);padding:14px;margin-bottom:12px;display:flex;gap:12px;cursor:pointer;transition:all .22s cubic-bezier(.34,1.56,.64,1)}
.mac:active{transform:scale(.98)}
.mac:nth-child(n){animation:slide-up .28s ease both}
.mat{width:68px;height:68px;border-radius:var(--rs);background:linear-gradient(135deg,#ddd,#c8c8c8);display:flex;align-items:center;justify-content:center;font-size:26px;flex-shrink:0;overflow:hidden}
.mat img{width:100%;height:100%;object-fit:cover}
.mai{flex:1;min-width:0}
.matl{font-size:14px;font-weight:800;color:var(--dk);margin-bottom:3px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.map{font-size:16px;font-weight:900;color:var(--acc);margin-bottom:4px}
.mas{display:inline-flex;align-items:center;gap:3px;padding:3px 9px;border-radius:18px;font-size:10px;font-weight:800}
.s-act{background:rgba(76,175,80,.12);color:var(--gn)}
.s-mod{background:rgba(255,193,7,.15);color:#b8860b}
.s-rej{background:rgba(244,67,54,.12);color:var(--rd)}
.s-ina{background:rgba(0,0,0,.06);color:var(--gr)}
.mav{font-size:11px;font-weight:600;color:var(--lg);margin-top:3px}
.tabs{display:flex;gap:7px;padding:0 18px 18px}
.tb{flex:1;padding:10px;background:var(--bg);border:none;border-radius:var(--rs);font-size:11px;font-weight:800;color:var(--gr);cursor:pointer;box-shadow:var(--sh);transition:all .2s;font-family:'Nunito',sans-serif}
.tb.active{background:linear-gradient(135deg,var(--acc),var(--acc2));color:#fff;box-shadow:0 6px 14px rgba(255,87,34,.25)}
.ph{background:var(--bg);margin:0 18px 18px;border-radius:var(--r);box-shadow:var(--sh);padding:22px;display:flex;align-items:center;gap:16px}
.pav{width:66px;height:66px;background:linear-gradient(135deg,var(--acc),var(--acc2));border-radius:50%;display:flex;align-items:center;justify-content:center;flex-shrink:0;box-shadow:0 8px 18px rgba(255,87,34,.3);animation:float 2.5s ease-in-out infinite}
.pnm{font-size:20px;font-weight:900;color:var(--dk);margin-bottom:3px}
.psi{font-size:12px;font-weight:600;color:var(--gr);margin-bottom:7px}
.tpl{display:inline-flex;align-items:center;gap:4px;padding:4px 11px;background:linear-gradient(135deg,var(--acc),var(--acc2));border-radius:18px;font-size:10px;font-weight:800;color:#fff;text-transform:uppercase}
.sg{display:grid;grid-template-columns:1fr 1fr;gap:12px;padding:0 18px;margin-bottom:18px}
.si2{background:var(--bg);border-radius:var(--r);padding:16px;box-shadow:var(--sh);text-align:center}
.sv{font-size:26px;font-weight:900;color:var(--acc);line-height:1;margin-bottom:3px}
.sl{font-size:11px;font-weight:700;color:var(--gr);text-transform:uppercase;letter-spacing:.4px}
.ir{display:flex;align-items:center;justify-content:space-between;padding:13px 18px;border-bottom:1px solid rgba(0,0,0,.04);cursor:pointer;transition:background .15s}
.ir:active{background:rgba(0,0,0,.02)}
.irl{display:flex;align-items:center;gap:11px}
.iric{display:flex;align-items:center;justify-content:center;width:22px;height:22px;flex-shrink:0;color:var(--acc)}
.irlb{font-size:15px;font-weight:700;color:var(--dk)}
.irv{font-size:14px;font-weight:700;color:var(--gr)}
.ira{color:var(--lg);display:flex;align-items:center}
.prc{background:var(--bg);border-radius:var(--r);box-shadow:var(--sh);padding:20px;margin-bottom:14px;position:relative;overflow:hidden}
.prc.ft{background:linear-gradient(135deg,var(--acc),var(--acc2));box-shadow:0 12px 28px rgba(255,87,34,.3)}
.prb{display:inline-block;padding:4px 11px;border-radius:18px;font-size:10px;font-weight:800;text-transform:uppercase;background:rgba(255,87,34,.12);color:var(--acc);margin-bottom:10px}
.prc.ft .prb{background:rgba(255,255,255,.25);color:#fff}
.prn{font-size:20px;font-weight:900;color:var(--dk);margin-bottom:3px}
.prc.ft .prn{color:#fff}
.prp{font-size:34px;font-weight:900;color:var(--acc);line-height:1}
.prc.ft .prp{color:#fff}
.prp span{font-size:16px;font-weight:600;color:var(--gr)}
.prc.ft .prp span{color:rgba(255,255,255,.75)}
.prpe{font-size:13px;font-weight:600;color:var(--gr);margin-bottom:14px}
.prc.ft .prpe{color:rgba(255,255,255,.85)}
.fl{list-style:none;margin-bottom:18px}
.fl li{padding:5px 0;font-size:13px;font-weight:600;color:#666;padding-left:20px;position:relative}
.fl li::before{content:'‚úì';position:absolute;left:0;color:var(--acc);font-weight:900}
.prc.ft .fl li{color:rgba(255,255,255,.9)}
.prc.ft .fl li::before{color:#fff}
.pot{position:absolute;top:-1px;right:18px;background:var(--dk);color:#fff;padding:4px 12px;border-radius:0 0 12px 12px;font-size:10px;font-weight:800;text-transform:uppercase}
.prc:nth-child(1){animation:slide-up .32s ease both}
.prc:nth-child(2){animation:slide-up .32s ease .08s both}
.prc:nth-child(3){animation:slide-up .32s ease .16s both}
.fst{display:none}
.fst.active{display:block}
.sti{display:flex;align-items:center;gap:5px;padding:0 18px 18px}
.sdt{height:4px;border-radius:2px;background:var(--bg);box-shadow:var(--ins);flex:1;transition:all .3s}
.sdt.done{background:var(--acc);box-shadow:0 2px 6px rgba(255,87,34,.3)}
.cgr{display:grid;grid-template-columns:1fr 1fr;gap:11px}
.cbtn{padding:18px 14px;background:var(--bg);border:none;border-radius:var(--r);box-shadow:var(--sh);display:flex;flex-direction:column;align-items:center;gap:7px;cursor:pointer;transition:all .22s cubic-bezier(.34,1.56,.64,1);font-family:'Nunito',sans-serif}
.cbtn:active{box-shadow:var(--ins);transform:scale(.96)}
.cbtn.sel{background:linear-gradient(135deg,var(--acc),var(--acc2));box-shadow:0 8px 18px rgba(255,87,34,.3)}
.cbtn .ce{font-size:28px;display:flex;align-items:center;justify-content:center}
.cbtn .cn{font-size:13px;font-weight:800;color:var(--dk)}
.cbtn.sel .cn{color:#fff}
.pgr{display:flex;gap:8px;padding-bottom:4px;overflow-x:auto;scrollbar-width:none;min-height:98px;align-items:center}
.psl{width:90px;height:90px;border-radius:var(--rs);background:linear-gradient(135deg,#ddd,#c8c8c8);flex-shrink:0;position:relative;overflow:hidden}
.psl img{width:100%;height:100%;object-fit:cover}
.rmv{position:absolute;top:4px;right:4px;width:20px;height:20px;background:rgba(0,0,0,.55);border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:10px;color:#fff;cursor:pointer;font-weight:900;z-index:1}
.padd{width:90px;height:90px;border-radius:var(--rs);background:var(--bg);box-shadow:var(--sh);flex-shrink:0;display:flex;align-items:center;justify-content:center;cursor:pointer;font-size:28px;color:var(--acc)}
.aslider{width:100%;height:260px;background:linear-gradient(135deg,#ddd,#c8c8c8);display:flex;align-items:center;justify-content:center;position:relative;overflow:hidden}
.aslider img{width:100%;height:100%;object-fit:cover}
.asl-nav{position:absolute;bottom:12px;left:50%;transform:translateX(-50%);display:flex;gap:6px}
.asl-dot{width:7px;height:7px;border-radius:50%;background:rgba(255,255,255,.5);transition:all .2s}
.asl-dot.active{background:#fff;width:20px;border-radius:4px}
.adb{padding:18px}
.adp{font-size:30px;font-weight:900;color:var(--acc);margin-bottom:5px}
.adt{font-size:20px;font-weight:900;color:var(--dk);margin-bottom:14px}
.adr{display:flex;align-items:center;gap:10px;padding:10px 0;border-bottom:1px solid rgba(0,0,0,.05)}
.adr:last-of-type{border-bottom:none}
.adri{font-size:18px;flex-shrink:0}
.adrt{font-size:14px;font-weight:600;color:var(--dk)}
.adrk{font-size:11px;font-weight:700;color:var(--gr)}
.actr{display:flex;gap:10px;margin-top:18px}
.fab2{width:52px;height:52px;background:var(--bg);border-radius:16px;border:none;display:flex;align-items:center;justify-content:center;cursor:pointer;box-shadow:var(--sh);transition:all .2s;flex-shrink:0;color:var(--gr)}
.fab2:active{box-shadow:var(--ins);transform:scale(.95)}
.fab2.faved{background:linear-gradient(135deg,var(--acc),var(--acc2));color:#fff;box-shadow:0 8px 20px rgba(255,87,34,.32)}
.overlay{position:fixed;inset:0;background:rgba(0,0,0,.38);z-index:500;display:none;align-items:flex-end;justify-content:center}
.overlay.show{display:flex;animation:fadeIn .2s ease}
.modal{background:var(--bg);border-radius:28px 28px 0 0;padding:24px 18px 36px;width:100%;max-height:88vh;overflow-y:auto;animation:modal-in .3s ease;position:relative}
.mclose{position:absolute;right:18px;top:18px;width:34px;height:34px;background:var(--bg);border-radius:50%;border:none;box-shadow:var(--sh);cursor:pointer;display:flex;align-items:center;justify-content:center;color:var(--gr);font-size:16px}
.mclose:active{box-shadow:var(--ins)}
.pm{background:var(--bg);border-radius:var(--r);box-shadow:var(--sh);padding:15px;margin-bottom:12px;display:flex;align-items:center;gap:14px;cursor:pointer;transition:all .22s cubic-bezier(.34,1.56,.64,1)}
.pm:active{transform:scale(.97)}
.pm.sel{box-shadow:0 0 0 2.5px var(--acc),4px 4px 10px rgba(0,0,0,.1)}
.pmic{width:44px;height:44px;border-radius:12px;display:flex;align-items:center;justify-content:center;color:#fff;font-size:20px;flex-shrink:0}
.pmt{font-size:15px;font-weight:800;color:var(--dk)}
.pmst{font-size:12px;font-weight:600;color:var(--gr)}
.notif-bar{position:fixed;top:12px;right:12px;left:12px;z-index:9998;display:flex;flex-direction:column;gap:8px;pointer-events:none}
.notif{background:var(--dk);color:#fff;border-radius:18px;padding:12px 15px;display:flex;align-items:center;gap:11px;box-shadow:0 8px 28px rgba(0,0,0,.35);animation:notif-slide .4s cubic-bezier(.34,1.56,.64,1) forwards;cursor:pointer;pointer-events:all}
.notif-ic{width:38px;height:38px;border-radius:12px;display:flex;align-items:center;justify-content:center;font-size:20px;flex-shrink:0}
.nic-gn{background:rgba(76,175,80,.25)}
.nic-yl{background:rgba(255,193,7,.25)}
.nic-rd{background:rgba(244,67,54,.25)}
.nic-bl{background:rgba(33,150,243,.25)}
.nic-acc{background:rgba(255,87,34,.25)}
.notif-tl{font-size:13px;font-weight:800;margin-bottom:1px}
.notif-bd{font-size:11px;font-weight:600;color:rgba(255,255,255,.72);line-height:1.3}
.notif-item{background:var(--bg);border-radius:var(--r);box-shadow:var(--sh);padding:14px;margin-bottom:12px;display:flex;gap:12px;position:relative;cursor:pointer}
.notif-item.unread::after{content:'';position:absolute;top:14px;right:14px;width:8px;height:8px;background:var(--acc);border-radius:50%;animation:pulse-dot 1.6s ease-in-out infinite}
.bdot{position:absolute;top:6px;right:6px;width:8px;height:8px;background:var(--acc);border-radius:50%;animation:pulse-dot 1.6s ease-in-out infinite;box-shadow:0 0 6px rgba(255,87,34,.7)}
.admin-card{background:var(--bg);border-radius:var(--r);box-shadow:var(--sh);padding:16px;margin-bottom:12px}
.stat-grid{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-bottom:18px}
.stat-box{background:var(--bg);border-radius:var(--rs);box-shadow:var(--sh);padding:14px;text-align:center}
.stat-v{font-size:24px;font-weight:900;color:var(--acc);line-height:1;margin-bottom:2px}
.stat-l{font-size:10px;font-weight:700;color:var(--gr);text-transform:uppercase;letter-spacing:.4px}
.mod-card{background:var(--bg);border-radius:var(--r);box-shadow:var(--sh);overflow:hidden;margin-bottom:14px}
.mod-img{width:100%;height:180px;background:#ddd;display:flex;align-items:center;justify-content:center;font-size:60px;overflow:hidden}
.mod-img img{width:100%;height:100%;object-fit:cover}
.mod-body{padding:14px}
.mod-title{font-size:16px;font-weight:800;color:var(--dk);margin-bottom:4px}
.mod-meta{font-size:12px;font-weight:600;color:var(--gr);margin-bottom:12px}
.rfb{background:var(--bg);border-radius:var(--rs);box-shadow:var(--ins);padding:12px 14px;font-size:13px;font-weight:700;color:var(--dk);margin-bottom:12px;word-break:break-all}
.rc{display:flex;align-items:center;gap:12px;padding:12px 0;border-bottom:1px solid rgba(0,0,0,.04)}
.rav{width:38px;height:38px;border-radius:50%;background:var(--bg);box-shadow:var(--sh);display:flex;align-items:center;justify-content:center;flex-shrink:0;font-size:18px}
.rn{font-size:14px;font-weight:800;color:var(--dk)}
.rd-row{font-size:12px;font-weight:600;color:var(--gr)}
.rr{font-size:14px;font-weight:900;color:var(--acc)}
.sugg-wrap{padding:0 18px;margin-bottom:14px}
.sugg-tl{font-size:11px;font-weight:800;color:var(--gr);margin-bottom:8px;text-transform:uppercase;letter-spacing:.4px}
.sugg-list{display:flex;gap:7px;flex-wrap:wrap}
.sugg-tag{padding:7px 13px;background:var(--bg);border-radius:var(--rp);box-shadow:var(--sh);font-size:13px;font-weight:700;color:var(--dk);cursor:pointer;border:none;font-family:'Nunito',sans-serif;transition:all .2s}
.sugg-tag:active{transform:scale(.95)}
#toast{position:fixed;bottom:110px;left:50%;transform:translateX(-50%) translateY(14px);background:var(--dk);color:#fff;padding:12px 22px;border-radius:var(--rp);font-size:14px;font-weight:700;opacity:0;transition:opacity .25s,transform .3s;pointer-events:none;white-space:nowrap;z-index:9999;max-width:90vw;text-align:center}
#toast.show{opacity:1;transform:translateX(-50%) translateY(0);animation:toast-in .35s ease}
.empty{text-align:center;padding:48px 24px}
.empty .ei{font-size:56px;margin-bottom:16px;display:block;animation:float 2.5s ease-in-out infinite}
.empty .et{font-size:18px;font-weight:900;color:var(--dk);margin-bottom:8px}
.empty .es{font-size:14px;font-weight:600;color:var(--gr)}
.sep{height:1px;background:rgba(0,0,0,.05)}
</style>
</head>
<body>
<div id="toast"></div>
<div class="notif-bar" id="notif-bar"></div>
<div class="overlay" id="overlay" onclick="closeOverlay(event)"><div class="modal" id="modal-body"></div></div>

<!-- HOME -->
<div class="screen active" id="sc-home">
  <div class="hdr">
    <div class="hdr-logo"><div class="logo-ic">üêæ</div><div class="logo-nm">Puppy<span>Post</span></div></div>
    <button class="hbtn" onclick="navTo('notifications')" style="position:relative">
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"/><path d="M13.73 21a2 2 0 0 1-3.46 0"/></svg>
      <div class="bdot" id="notif-dot" style="display:none"></div>
    </button>
  </div>
  <div style="padding:0 18px 14px;position:relative">
    <svg style="position:absolute;left:30px;top:50%;transform:translateY(-50%);color:var(--lg);pointer-events:none" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="7"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg>
    <input class="sinp" placeholder="–ü–æ–∏—Å–∫ –æ–±—ä—è–≤–ª–µ–Ω–∏–π..." onfocus="navTo('search')">
  </div>
  <div class="csc" id="home-cats">
    <button class="cc active" onclick="filterCat('',this)">–í—Å–µ</button>
    <button class="cc" onclick="filterCat('üëï –û–¥–µ–∂–¥–∞',this)">üëï –û–¥–µ–∂–¥–∞</button>
    <button class="cc" onclick="filterCat('üëü –û–±—É–≤—å',this)">üëü –û–±—É–≤—å</button>
    <button class="cc" onclick="filterCat('üì± –¢–µ—Ö–Ω–∏–∫–∞',this)">üì± –¢–µ—Ö–Ω–∏–∫–∞</button>
    <button class="cc" onclick="filterCat('üéÅ –î—Ä—É–≥–æ–µ',this)">üéÅ –î—Ä—É–≥–æ–µ</button>
  </div>
  <div id="pinned-section" style="display:none">
    <div class="stl" style="margin-bottom:10px;display:flex;align-items:center;gap:6px">‚≠ê –ó–∞–∫—Ä–µ–ø–ª—ë–Ω–Ω—ã–µ</div>
    <div class="hsc" id="pinned-list"></div>
  </div>
  <div class="stl" style="margin-top:10px;display:flex;align-items:center;justify-content:space-between;padding-right:18px">
    <span>–û–±—ä—è–≤–ª–µ–Ω–∏—è</span><span id="ads-count" style="font-size:13px;font-weight:700;color:var(--gr)"></span>
  </div>
  <div class="pc" id="ads-list"></div>
</div>

<!-- SEARCH -->
<div class="screen" id="sc-search">
  <div class="hdr">
    <button class="bb" onclick="navBack()"><svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="15 18 9 12 15 6"/></svg></button>
    <div style="flex:1;position:relative">
      <svg style="position:absolute;left:14px;top:50%;transform:translateY(-50%);color:var(--lg);pointer-events:none" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="7"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg>
      <input class="sinp" id="search-inp" placeholder="–ü–æ–∏—Å–∫..." oninput="doSearch(this.value)">
    </div>
  </div>
  <div id="search-sugg"></div>
  <div class="csc" id="search-cats">
    <button class="cc active" onclick="filterCat('',this)">–í—Å–µ</button>
    <button class="cc" onclick="filterCat('üëï –û–¥–µ–∂–¥–∞',this)">üëï –û–¥–µ–∂–¥–∞</button>
    <button class="cc" onclick="filterCat('üëü –û–±—É–≤—å',this)">üëü –û–±—É–≤—å</button>
    <button class="cc" onclick="filterCat('üì± –¢–µ—Ö–Ω–∏–∫–∞',this)">üì± –¢–µ—Ö–Ω–∏–∫–∞</button>
    <button class="cc" onclick="filterCat('üéÅ –î—Ä—É–≥–æ–µ',this)">üéÅ –î—Ä—É–≥–æ–µ</button>
  </div>
  <div class="pc" id="search-results"></div>
</div>

<!-- AD DETAIL -->
<div class="screen" id="sc-ad-detail">
  <div class="hdr">
    <button class="bb" onclick="navBack()"><svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="15 18 9 12 15 6"/></svg></button>
    <div class="hdr-logo"><div class="logo-nm" style="font-size:15px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap" id="ad-hdr">–û–±—ä—è–≤–ª–µ–Ω–∏–µ</div></div>
    <button class="hbtn" id="fav-hbtn" onclick="toggleFav()"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.2" stroke-linecap="round" stroke-linejoin="round"><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"/></svg></button>
  </div>
  <div class="aslider" id="ad-slider"><span id="ad-slider-emoji" style="font-size:74px"></span></div>
  <div class="adb">
    <div class="adp" id="ad-det-price"></div>
    <div class="adt" id="ad-det-title"></div>
    <div id="ad-det-rows"></div>
    <div class="actr">
      <button class="btn ba" style="flex:1" onclick="contactSeller()">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/></svg>
        –ù–∞–ø–∏—Å–∞—Ç—å –ø—Ä–æ–¥–∞–≤—Ü—É
      </button>
      <button class="fab2" id="fav-fab" onclick="toggleFav()"><svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.2" stroke-linecap="round" stroke-linejoin="round"><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"/></svg></button>
    </div>
  </div>
</div>

<!-- CREATE AD -->
<div class="screen" id="sc-create">
  <div class="hdr">
    <button class="bb" onclick="backCreate()"><svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="15 18 9 12 15 6"/></svg></button>
    <div class="hdr-logo"><div class="logo-nm" style="font-size:16px">–°–æ–∑–¥–∞—Ç—å –æ–±—ä—è–≤–ª–µ–Ω–∏–µ</div></div>
  </div>
  <div class="sti" id="stepi"></div>
  <!-- step 0: category -->
  <div class="fst active" id="step-0">
    <div class="stl">–ö–∞—Ç–µ–≥–æ—Ä–∏—è</div>
    <div class="pc"><div class="cgr">
      <button class="cbtn" onclick="selCat('üëï –û–¥–µ–∂–¥–∞',this)"><div class="ce">üëï</div><div class="cn">–û–¥–µ–∂–¥–∞</div></button>
      <button class="cbtn" onclick="selCat('üëü –û–±—É–≤—å',this)"><div class="ce">üëü</div><div class="cn">–û–±—É–≤—å</div></button>
      <button class="cbtn" onclick="selCat('üì± –¢–µ—Ö–Ω–∏–∫–∞',this)"><div class="ce">üì±</div><div class="cn">–¢–µ—Ö–Ω–∏–∫–∞</div></button>
      <button class="cbtn" onclick="selCat('üéÅ –î—Ä—É–≥–æ–µ',this)"><div class="ce">üéÅ</div><div class="cn">–î—Ä—É–≥–æ–µ</div></button>
    </div></div>
  </div>
  <!-- step 1: details -->
  <div class="fst" id="step-1">
    <div class="pc">
      <div class="fgr"><label class="flb">–ù–∞–∑–≤–∞–Ω–∏–µ *</label><input class="inp" id="ad-title" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: Nike Air Max 90"></div>
      <div class="fgr"><label class="flb">–û–ø–∏—Å–∞–Ω–∏–µ</label><textarea class="txta" id="ad-desc" placeholder="–†–∞—Å—Å–∫–∞–∂–∏—Ç–µ –ø–æ–¥—Ä–æ–±–Ω–µ–µ..."></textarea></div>
      <div class="fgr" id="size-gr" style="display:none"><label class="flb">–†–∞–∑–º–µ—Ä</label><input class="inp" id="ad-size" placeholder="XS/S/M/L/XL –∏–ª–∏ 42/43..."></div>
      <div class="fgr"><label class="flb">–°–æ—Å—Ç–æ—è–Ω–∏–µ *</label>
        <div class="chrow">
          <button class="ch" onclick="selChip(this,'condition','üÜï –ù–æ–≤–æ–µ')">üÜï –ù–æ–≤–æ–µ</button>
          <button class="ch" onclick="selChip(this,'condition','‚ú® –û—Ç–ª–∏—á–Ω–æ–µ')">‚ú® –û—Ç–ª–∏—á–Ω–æ–µ</button>
          <button class="ch" onclick="selChip(this,'condition','üëç –•–æ—Ä–æ—à–µ–µ')">üëç –•–æ—Ä–æ—à–µ–µ</button>
          <button class="ch" onclick="selChip(this,'condition','üôÇ –£–¥–æ–≤–ª.')">üôÇ –£–¥–æ–≤–ª.</button>
        </div>
      </div>
      <button class="btn ba" onclick="nextStep()">–î–∞–ª–µ–µ ‚Üí</button>
    </div>
  </div>
  <!-- step 2: price/city/delivery -->
  <div class="fst" id="step-2">
    <div class="pc">
      <div class="fgr"><label class="flb">–¶–µ–Ω–∞ ‚ÇΩ *</label><input class="inp" id="ad-price" type="number" min="0" placeholder="0 = –±–µ—Å–ø–ª–∞—Ç–Ω–æ"></div>
      <div class="fgr"><label class="flb">–ì–æ—Ä–æ–¥</label><input class="inp" id="ad-city" placeholder="–ú–æ—Å–∫–≤–∞, –°–ü–±..."></div>
      <div class="fgr"><label class="flb">–î–æ—Å—Ç–∞–≤–∫–∞</label>
        <div class="chrow">
          <button class="ch" onclick="togDeliv(this,'üöö –î–æ—Å—Ç–∞–≤–∫–∞')">üöö –î–æ—Å—Ç–∞–≤–∫–∞</button>
          <button class="ch" onclick="togDeliv(this,'ü§ù –°–∞–º–æ–≤—ã–≤–æ–∑')">ü§ù –°–∞–º–æ–≤—ã–≤–æ–∑</button>
          <button class="ch" onclick="togDeliv(this,'üì¶ –ê–≤–∏—Ç–æ –¥–æ—Å—Ç–∞–≤–∫–∞')">üì¶ –ê–≤–∏—Ç–æ</button>
        </div>
      </div>
      <button class="btn ba" onclick="nextStep()">–î–∞–ª–µ–µ ‚Üí</button>
    </div>
  </div>
  <!-- step 3: photos -->
  <div class="fst" id="step-3">
    <div class="pc">
      <div class="fgr"><label class="flb" style="margin-bottom:10px">–§–æ—Ç–æ (–¥–æ 10)</label>
        <input type="file" id="photo-file" accept="image/*" multiple style="display:none" onchange="handlePhotos(this)">
        <div class="pgr" id="photo-grid"></div>
        <p style="font-size:12px;font-weight:600;color:var(--gr);margin-top:8px">–ü–µ—Ä–≤–æ–µ —Ñ–æ—Ç–æ ‚Äî –≥–ª–∞–≤–Ω–æ–µ</p>
      </div>
      <button class="btn ba" style="margin-bottom:10px" onclick="nextStep()">–î–∞–ª–µ–µ ‚Üí</button>
      <button class="btn bg" onclick="nextStep()">–ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å</button>
    </div>
  </div>
  <!-- step 4: contact + submit -->
  <div class="fst" id="step-4">
    <div class="pc">
      <div class="fgr"><label class="flb">–ö–æ–Ω—Ç–∞–∫—Ç *</label><input class="inp" id="ad-contact" placeholder="@telegram –∏–ª–∏ –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞">
        <p style="font-size:12px;font-weight:600;color:var(--gr);margin-top:6px">–ü–æ–∫—É–ø–∞—Ç–µ–ª–∏ –Ω–∞–ø–∏—à—É—Ç –Ω–∞ —ç—Ç–æ—Ç –∫–æ–Ω—Ç–∞–∫—Ç</p>
      </div>
      <div id="create-preview" style="margin-bottom:18px"></div>
      <button class="btn ba" onclick="submitAd()">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.2" stroke-linecap="round" stroke-linejoin="round"><line x1="22" y1="2" x2="11" y2="13"/><polygon points="22 2 15 22 11 13 2 9 22 2"/></svg>
        –û—Ç–ø—Ä–∞–≤–∏—Ç—å –Ω–∞ –º–æ–¥–µ—Ä–∞—Ü–∏—é
      </button>
    </div>
  </div>
</div>

<!-- MY ADS -->
<div class="screen" id="sc-my-ads">
  <div class="hdr">
    <div class="hdr-logo"><div class="logo-nm" style="font-size:17px">–ú–æ–∏ –æ–±—ä—è–≤–ª–µ–Ω–∏—è</div></div>
    <button class="hbtn" onclick="navTo('create');initCreate()"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg></button>
  </div>
  <div class="tabs">
    <button class="tb active" id="tab-active" onclick="setTab('active',this)">–ê–∫—Ç–∏–≤–Ω—ã–µ</button>
    <button class="tb" id="tab-moderation" onclick="setTab('moderation',this)">–ú–æ–¥–µ—Ä–∞—Ü–∏—è</button>
    <button class="tb" id="tab-archive" onclick="setTab('archive',this)">–ê—Ä—Ö–∏–≤</button>
  </div>
  <div class="pc" id="my-ads-list"></div>
</div>

<!-- MY AD DETAIL -->
<div class="screen" id="sc-my-ad-detail">
  <div class="hdr">
    <button class="bb" onclick="navBack()"><svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="15 18 9 12 15 6"/></svg></button>
    <div class="hdr-logo"><div class="logo-nm" style="font-size:15px" id="my-ad-hdr">–û–±—ä—è–≤–ª–µ–Ω–∏–µ</div></div>
  </div>
  <div class="pc" id="my-ad-detail-body" style="padding-top:14px"></div>
</div>

<!-- FAVOURITES -->
<div class="screen" id="sc-favs">
  <div class="hdr"><div class="hdr-logo"><div class="logo-nm" style="font-size:17px">‚ù§Ô∏è –ò–∑–±—Ä–∞–Ω–Ω–æ–µ</div></div></div>
  <div class="pc" id="favs-list"></div>
</div>

<!-- PROFILE -->
<div class="screen" id="sc-profile">
  <div class="hdr">
    <div class="hdr-logo"><div class="logo-nm" style="font-size:17px">–ü—Ä–æ—Ñ–∏–ª—å</div></div>
    <button class="hbtn" onclick="navTo('notifications')" style="position:relative">
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"/><path d="M13.73 21a2 2 0 0 1-3.46 0"/></svg>
      <div class="bdot" id="notif-dot2" style="display:none"></div>
    </button>
  </div>
  <div class="ph">
    <div class="pav"><svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="#fff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="8" r="4"/><path d="M4 20c0-4 3.58-7 8-7s8 3 8 7"/></svg></div>
    <div><div class="pnm" id="prof-name">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å</div><div class="psi" id="prof-sub">–¢–∞—Ä–∏—Ñ: Free</div><div class="tpl" id="prof-tariff">FREE</div></div>
  </div>
  <div class="sg">
    <div class="si2"><div class="sv" id="prof-ads">0</div><div class="sl">–û–±—ä—è–≤–ª–µ–Ω–∏–π</div></div>
    <div class="si2"><div class="sv" id="prof-views">0</div><div class="sl">–ü—Ä–æ—Å–º–æ—Ç—Ä–æ–≤</div></div>
  </div>
  <div class="card" style="margin:0 18px 14px;padding:0">
    <div class="ir" onclick="navTo('subscriptions')">
      <div class="irl"><div class="iric">üí≥</div><div class="irlb">–¢–∞—Ä–∏—Ñ—ã –∏ –ø–æ–¥–ø–∏—Å–∫–∏</div></div>
      <div class="ira"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="9 18 15 12 9 6"/></svg></div>
    </div>
    <div class="sep"></div>
    <div class="ir" onclick="navTo('pin-ad')">
      <div class="irl"><div class="iric">‚≠ê</div><div class="irlb">–ó–∞–∫—Ä–µ–ø–∏—Ç—å –æ–±—ä—è–≤–ª–µ–Ω–∏–µ</div></div>
      <div class="ira"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="9 18 15 12 9 6"/></svg></div>
    </div>
    <div class="sep"></div>
    <div class="ir" onclick="navTo('referral')">
      <div class="irl"><div class="iric">üë•</div><div class="irlb">–†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è –ø—Ä–æ–≥—Ä–∞–º–º–∞</div></div>
      <div class="ira" style="gap:5px"><div class="irv" id="ref-bal-prof" style="color:var(--acc)">0‚ÇΩ</div><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="9 18 15 12 9 6"/></svg></div>
    </div>
    <div class="sep"></div>
    <div class="ir" onclick="navTo('notifications')">
      <div class="irl"><div class="iric">üîî</div><div class="irlb">–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è</div></div>
      <div class="ira" style="gap:5px"><div class="irv" id="notif-count-prof" style="color:var(--acc)"></div><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="9 18 15 12 9 6"/></svg></div>
    </div>
    <div class="sep" id="admin-sep" style="display:none"></div>
    <div class="ir" id="admin-row" style="display:none" onclick="navTo('admin')">
      <div class="irl"><div class="iric" style="color:var(--rd)">üõ°</div><div class="irlb" style="color:var(--rd)">–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ</div></div>
      <div class="ira"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="9 18 15 12 9 6"/></svg></div>
    </div>
  </div>
  <div style="padding:0 18px;font-size:12px;font-weight:600;color:var(--lg);text-align:center" id="prof-id"></div>
</div>

<!-- SUBSCRIPTIONS -->
<div class="screen" id="sc-subscriptions">
  <div class="hdr">
    <button class="bb" onclick="navBack()"><svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="15 18 9 12 15 6"/></svg></button>
    <div class="hdr-logo"><div class="logo-nm" style="font-size:17px">–¢–∞—Ä–∏—Ñ—ã</div></div>
  </div>
  <div class="pc">
    <div class="fgr" style="display:flex;gap:8px">
      <input class="inp" id="promo-inp" placeholder="–ü—Ä–æ–º–æ–∫–æ–¥ (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)">
      <button class="btn ba" style="width:auto;padding:13px 18px;flex-shrink:0" onclick="applyPromo()">OK</button>
    </div>
    <div id="promo-applied" style="display:none;margin-bottom:14px"></div>
    <div class="prc" id="free-plan">
      <div class="prb">Free</div>
      <div class="prn">–ë–µ—Å–ø–ª–∞—Ç–Ω—ã–π</div>
      <div class="prp">0‚ÇΩ <span>/–º–µ—Å</span></div>
      <div class="prpe">–ë–∞–∑–æ–≤—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏</div>
      <ul class="fl"><li>1 –æ–±—ä—è–≤–ª–µ–Ω–∏–µ –≤ –¥–µ–Ω—å</li><li>–î–æ 10 —Ñ–æ—Ç–æ</li><li>–ë–∞–∑–æ–≤—ã–π –ø–æ–∏—Å–∫</li></ul>
      <button class="btn bg" onclick="toast('–í—ã —É–∂–µ –Ω–∞ –±–µ—Å–ø–ª–∞—Ç–Ω–æ–º —Ç–∞—Ä–∏—Ñ–µ')">–ê–∫—Ç–∏–≤–µ–Ω</button>
    </div>
    <div class="prc">
      <div class="prb">Standard</div>
      <div class="prn">–°—Ç–∞–Ω–¥–∞—Ä—Ç</div>
      <div class="prp" id="std-price">299‚ÇΩ <span>/–º–µ—Å</span></div>
      <div class="prpe">–î–ª—è –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø—Ä–æ–¥–∞–≤—Ü–æ–≤</div>
      <ul class="fl"><li>3 –æ–±—ä—è–≤–ª–µ–Ω–∏—è –≤ –¥–µ–Ω—å</li><li>1 –∑–∞–∫—Ä–µ–ø 24—á/–º–µ—Å</li><li>–î–æ 10 —Ñ–æ—Ç–æ</li><li>–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç –≤ –ø–æ–∏—Å–∫–µ</li></ul>
      <button class="btn ba" onclick="openPayment('Standard')">–û—Ñ–æ—Ä–º–∏—Ç—å</button>
    </div>
    <div class="prc ft">
      <div class="pot">üî• –•–∏—Ç</div>
      <div class="prb">PRO</div>
      <div class="prn">–ü—Ä–æ—Ñ–∏</div>
      <div class="prp" id="pro-price">899‚ÇΩ <span>/–º–µ—Å</span></div>
      <div class="prpe">–ú–∞–∫—Å–∏–º—É–º –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–µ–π</div>
      <ul class="fl"><li>–ë–µ–∑–ª–∏–º–∏—Ç –æ–±—ä—è–≤–ª–µ–Ω–∏–π</li><li>3 –∑–∞–∫—Ä–µ–ø–∞ 168—á/–º–µ—Å</li><li>–î–æ 10 —Ñ–æ—Ç–æ</li><li>–¢–æ–ø –≤—ã–¥–∞—á–∏</li><li>PRO –∑–Ω–∞—á–æ–∫</li></ul>
      <button class="btn" style="background:#fff;color:var(--acc);box-shadow:0 6px 14px rgba(0,0,0,.15)" onclick="openPayment('PRO')">–û—Ñ–æ—Ä–º–∏—Ç—å PRO</button>
    </div>
  </div>
</div>

<!-- REFERRAL -->
<div class="screen" id="sc-referral">
  <div class="hdr">
    <button class="bb" onclick="navBack()"><svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="15 18 9 12 15 6"/></svg></button>
    <div class="hdr-logo"><div class="logo-nm" style="font-size:17px">üë• –†–µ—Ñ–µ—Ä–∞–ª—ã</div></div>
  </div>
  <div class="pc">
    <div style="background:linear-gradient(135deg,var(--acc),var(--acc2));border-radius:var(--r);padding:22px;margin-bottom:18px;box-shadow:0 12px 28px rgba(255,87,34,.3)">
      <div style="font-size:12px;font-weight:700;color:rgba(255,255,255,.8);margin-bottom:3px">–†–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã–π –±–∞–ª–∞–Ω—Å</div>
      <div style="font-size:36px;font-weight:900;color:#fff;line-height:1;margin-bottom:3px" id="ref-bal">0‚ÇΩ</div>
      <div style="font-size:13px;font-weight:600;color:rgba(255,255,255,.75)">–í—Å–µ–≥–æ –∑–∞—Ä–∞–±–æ—Ç–∞–Ω–æ: <span id="ref-total">0‚ÇΩ</span></div>
    </div>
    <div class="sg" style="padding:0;margin-bottom:18px">
      <div class="si2"><div class="sv" id="ref-cnt">0</div><div class="sl">–ü—Ä–∏–≥–ª–∞—à–µ–Ω–æ</div></div>
      <div class="si2"><div class="sv" id="ref-act">0</div><div class="sl">–ö—É–ø–∏–ª–∏ –ø–æ–¥–ø–∏—Å–∫—É</div></div>
    </div>
    <div class="card" style="margin-bottom:18px">
      <label class="flb" style="margin-bottom:10px">–í–∞—à–∞ —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è —Å—Å—ã–ª–∫–∞</label>
      <div class="rfb" id="ref-link">https://t.me/postcrab_bot?start=ref_...</div>
      <div style="display:flex;gap:8px">
        <button class="btn ba" style="flex:1" onclick="copyRef()">üìã –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
        <button class="btn bn" style="flex:1" onclick="shareRef()">üì§ –ü–æ–¥–µ–ª–∏—Ç—å—Å—è</button>
      </div>
    </div>
    <div style="font-size:13px;font-weight:800;color:var(--dk);margin-bottom:12px">–ú–æ–∏ —Ä–µ—Ñ–µ—Ä–∞–ª—ã</div>
    <div id="ref-list"></div>
    <button class="btn bn" style="margin-top:12px" onclick="openPayment('ref_balance')">üíé –ü–æ—Ç—Ä–∞—Ç–∏—Ç—å –±–∞–ª–∞–Ω—Å –Ω–∞ —Ç–∞—Ä–∏—Ñ</button>
  </div>
</div>

<!-- PIN AD -->
<div class="screen" id="sc-pin-ad">
  <div class="hdr">
    <button class="bb" onclick="navBack()"><svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="15 18 9 12 15 6"/></svg></button>
    <div class="hdr-logo"><div class="logo-nm" style="font-size:17px">‚≠ê –ó–∞–∫—Ä–µ–ø–∏—Ç—å</div></div>
  </div>
  <div class="pc">
    <div class="card" style="margin-bottom:18px">
      <div style="font-size:14px;font-weight:700;color:var(--dk);margin-bottom:6px">–ß—Ç–æ —Ç–∞–∫–æ–µ –∑–∞–∫—Ä–µ–ø?</div>
      <div style="font-size:13px;font-weight:600;color:var(--gr);line-height:1.6">–ó–∞–∫—Ä–µ–ø–ª—ë–Ω–Ω—ã–µ –æ–±—ä—è–≤–ª–µ–Ω–∏—è –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç—Å—è –ø–µ—Ä–≤—ã–º–∏ –≤ –ª–µ–Ω—Ç–µ. –î–æ—Å—Ç—É–ø–Ω–æ —Ç–æ–ª—å–∫–æ –ø–æ –ø–æ–¥–ø–∏—Å–∫–µ.</div>
    </div>
    <div id="pin-ad-list"></div>
  </div>
</div>

<!-- NOTIFICATIONS -->
<div class="screen" id="sc-notifications">
  <div class="hdr">
    <button class="bb" onclick="navBack()"><svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="15 18 9 12 15 6"/></svg></button>
    <div class="hdr-logo"><div class="logo-nm" style="font-size:17px">üîî –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è</div></div>
    <button class="hbtn" onclick="markAllRead()" style="font-size:10px;font-weight:800;color:var(--acc);width:auto;padding:0 10px;box-shadow:none">–í—Å—ë –ø—Ä–æ—á–∏—Ç–∞–Ω–æ</button>
  </div>
  <div class="pc" id="notif-list"></div>
</div>

<!-- ADMIN -->
<div class="screen" id="sc-admin">
  <div class="hdr">
    <button class="bb" onclick="navBack()"><svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="15 18 9 12 15 6"/></svg></button>
    <div class="hdr-logo"><div class="logo-nm" style="font-size:17px;color:var(--rd)">üõ° –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å</div></div>
  </div>
  <div class="pc">
    <div style="font-size:11px;font-weight:800;color:var(--gr);margin-bottom:12px;text-transform:uppercase;letter-spacing:.4px">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</div>
    <div class="stat-grid">
      <div class="stat-box"><div class="stat-v" id="stat-users">0</div><div class="stat-l">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</div></div>
      <div class="stat-box"><div class="stat-v" id="stat-ads">0</div><div class="stat-l">–û–±—ä—è–≤–ª–µ–Ω–∏–π</div></div>
      <div class="stat-box"><div class="stat-v" id="stat-active">0</div><div class="stat-l">–ê–∫—Ç–∏–≤–Ω—ã—Ö</div></div>
      <div class="stat-box"><div class="stat-v" id="stat-mod">0</div><div class="stat-l">–ú–æ–¥–µ—Ä–∞—Ü–∏—è</div></div>
    </div>
    <div style="font-size:11px;font-weight:800;color:var(--gr);margin-bottom:12px;text-transform:uppercase;letter-spacing:.4px">–û—á–µ—Ä–µ–¥—å –º–æ–¥–µ—Ä–∞—Ü–∏–∏</div>
    <div id="admin-mod-queue"></div>
    <div style="font-size:11px;font-weight:800;color:var(--gr);margin:18px 0 12px;text-transform:uppercase;letter-spacing:.4px">–ü–ª–∞—Ç–µ–∂–∏ (–æ–∂–∏–¥–∞—é—Ç)</div>
    <div id="admin-payments-list"></div>
    <div style="font-size:11px;font-weight:800;color:var(--gr);margin:18px 0 12px;text-transform:uppercase;letter-spacing:.4px">üì¢ –†–∞—Å—Å—ã–ª–∫–∞</div>
    <div class="fgr"><textarea class="txta" id="broadcast-text" placeholder="–°–æ–æ–±—â–µ–Ω–∏–µ –¥–ª—è –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π..." style="min-height:100px"></textarea></div>
    <button class="btn ba" onclick="sendBroadcast()" style="margin-bottom:18px">üì® –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Ä–∞—Å—Å—ã–ª–∫—É</button>
    <div style="font-size:11px;font-weight:800;color:var(--gr);margin-bottom:12px;text-transform:uppercase;letter-spacing:.4px">–ü—Ä–æ–º–æ–∫–æ–¥—ã</div>
    <div id="promo-list-admin"></div>
    <button class="btn bn" style="margin-top:10px" onclick="showPromoCreate()">‚ûï –°–æ–∑–¥–∞—Ç—å –ø—Ä–æ–º–æ–∫–æ–¥</button>
  </div>
</div>

<!-- NAV -->
<nav class="bnav">
  <button class="ni active" id="nav-home" onclick="navTo('home')">
    <span class="ic"><svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 9.5L12 3l9 6.5V20a1 1 0 0 1-1 1H4a1 1 0 0 1-1-1V9.5z"/><polyline points="9 21 9 12 15 12 15 21"/></svg></span>
    <span class="lb">–ì–ª–∞–≤–Ω–∞—è</span>
  </button>
  <button class="ni" id="nav-search" onclick="navTo('search')">
    <span class="ic"><svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="7"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg></span>
    <span class="lb">–ü–æ–∏—Å–∫</span>
  </button>
  <button class="ni" id="nav-create" onclick="navTo('create');initCreate()">
    <span class="ic"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg></span>
    <span class="lb">–°–æ–∑–¥–∞—Ç—å</span>
  </button>
  <button class="ni" id="nav-my-ads" onclick="navTo('my-ads');setTab(S.curTab)">
    <span class="ic"><svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.2" stroke-linecap="round" stroke-linejoin="round"><line x1="8" y1="6" x2="21" y2="6"/><line x1="8" y1="12" x2="21" y2="12"/><line x1="8" y1="18" x2="21" y2="18"/><circle cx="3.5" cy="6" r="1.2" fill="currentColor"/><circle cx="3.5" cy="12" r="1.2" fill="currentColor"/><circle cx="3.5" cy="18" r="1.2" fill="currentColor"/></svg></span>
    <span class="lb">–ú–æ–∏</span>
  </button>
  <button class="ni" id="nav-profile" onclick="navTo('profile')">
    <span class="ic"><svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="8" r="4"/><path d="M4 20c0-4 3.58-7 8-7s8 3 8 7"/></svg><div class="nbadge" id="nav-profile-badge" style="display:none"></div></span>
    <span class="lb">–ü—Ä–æ—Ñ–∏–ª—å</span>
  </button>
</nav>

<script>
'use strict';
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê CONFIG ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const TARIFFS={Free:{daily_ads:1,pins:0,pin_hours:0,price:0},Standard:{daily_ads:3,pins:1,pin_hours:24,price:299},PRO:{daily_ads:50,pins:3,pin_hours:168,price:899}};
const PAYMENT={yoomoney:'https://yoomoney.ru/to/4100119456604619',crypto_std:'https://t.me/send?start=IVRWI4KCIZoj',crypto_pro:'https://t.me/send?start=IVRMtMS6xa0a',tinkoff:'2200701043238127'};
const ADMIN_IDS=[6115882628];
const BOT='postcrab_bot';
const SYNONYMS={'–∞–π—Ñ–æ–Ω':['iphone','apple'],'iphone':['–∞–π—Ñ–æ–Ω','apple'],'—Å–∞–º—Å—É–Ω–≥':['samsung','–≥–∞–ª–∞–∫—Å–∏'],'samsung':['—Å–∞–º—Å—É–Ω–≥','–≥–∞–ª–∞–∫—Å–∏'],'–∫—Ä–æ—Å—Å–æ–≤–∫–∏':['–∫–µ–¥—ã','–æ–±—É–≤—å'],'–Ω–æ—É—Ç–±—É–∫':['laptop','–Ω–æ—É—Ç'],'—Ç–µ–ª–µ—Ñ–æ–Ω':['—Å–º–∞—Ä—Ç—Ñ–æ–Ω','phone']};

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê STORAGE ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const LS=k=>{try{return JSON.parse(localStorage.getItem(k))}catch{return null}};
const SS=(k,v)=>{try{localStorage.setItem(k,JSON.stringify(v))}catch{}};

const S={
  user: LS('pp_user')||{name:'–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å',tg_id:null,tariff:'Free',tariff_end:null,pins_used:0,ref_balance:0,ref_total:0,daily_ads:0,last_daily_reset:null,views_total:0},
  ads: LS('pp_ads')||[],
  myAds: LS('pp_my_ads')||[],
  favs: LS('pp_favs')||[],
  notifs: LS('pp_notifs')||[],
  promoCodes: LS('pp_promos')||[],
  payments: LS('pp_payments')||[],
  referrals: LS('pp_refs')||[],
  searchHist: LS('pp_search_hist')||[],
  curAdId:null,prevSc:'home',curSc:'home',
  createStep:0,newAd:{},photos:[],deliveries:[],
  promoDiscount:0,promoCode:'',
  curCat:'',curTab:'active',
  selPayTariff:'',selPayMethod:'',
  curSlide:0,
};
function save(){SS('pp_user',S.user);SS('pp_ads',S.ads);SS('pp_my_ads',S.myAds);SS('pp_favs',S.favs);SS('pp_notifs',S.notifs);SS('pp_promos',S.promoCodes);SS('pp_payments',S.payments);SS('pp_refs',S.referrals);SS('pp_search_hist',S.searchHist);}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê DEMO DATA ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function initDemo(){
  if(S.ads.length>0)return;
  const n=Date.now();
  S.ads=[
    {id:1,user_id:999,title:'Nike Air Max 90 White',category:'üëü –û–±—É–≤—å',price:7500,condition:'‚ú® –û—Ç–ª–∏—á–Ω–æ–µ',size:'43',city:'–ú–æ—Å–∫–≤–∞',delivery:'üöö –î–æ—Å—Ç–∞–≤–∫–∞ / ü§ù –°–∞–º–æ–≤—ã–≤–æ–∑',desc:'–ö—Ä–æ—Å—Å–æ–≤–∫–∏ –≤ –æ—Ç–ª–∏—á–Ω–æ–º —Å–æ—Å—Ç–æ—è–Ω–∏–∏, –Ω–æ—Å–∏–ª 2 —Ä–∞–∑–∞. –û—Ä–∏–≥–∏–Ω–∞–ª, –∫–æ—Ä–æ–±–∫–∞ –≤ –Ω–∞–ª–∏—á–∏–∏.',contact:'@seller1',photos:[],emoji:'üëü',status:'active',pinned_until:n+86400000*3,views:148,created_at:n-86400000*2},
    {id:2,user_id:998,title:'iPhone 13 Pro 256GB',category:'üì± –¢–µ—Ö–Ω–∏–∫–∞',price:59000,condition:'üëç –•–æ—Ä–æ—à–µ–µ',city:'–°–ü–±',delivery:'ü§ù –°–∞–º–æ–≤—ã–≤–æ–∑',desc:'–ü—Ä–æ–¥–∞—é iPhone 13 Pro 256GB. –¶–∞—Ä–∞–ø–∏–Ω –Ω–µ—Ç, –∞–∫–∫—É–º—É–ª—è—Ç–æ—Ä 89%.',contact:'@seller2',photos:[],emoji:'üì±',status:'active',pinned_until:null,views:312,created_at:n-86400000},
    {id:3,user_id:997,title:'–ö—É—Ä—Ç–∫–∞ Columbia –æ—Å–µ–Ω—å',category:'üëï –û–¥–µ–∂–¥–∞',price:3200,condition:'üÜï –ù–æ–≤–æ–µ',size:'M',city:'–ö–∞–∑–∞–Ω—å',delivery:'üì¶ –ê–≤–∏—Ç–æ –¥–æ—Å—Ç–∞–≤–∫–∞',desc:'–ö—É—Ä—Ç–∫–∞ Columbia, —Ä–∞–∑–º–µ—Ä M, –Ω–æ–≤–∞—è —Å –±–∏—Ä–∫–æ–π.',contact:'@seller3',photos:[],emoji:'üß•',status:'active',pinned_until:null,views:67,created_at:n-3600000*5},
    {id:4,user_id:996,title:'MacBook Air M2 2022',category:'üì± –¢–µ—Ö–Ω–∏–∫–∞',price:89000,condition:'‚ú® –û—Ç–ª–∏—á–Ω–æ–µ',city:'–ú–æ—Å–∫–≤–∞',delivery:'ü§ù –°–∞–º–æ–≤—ã–≤–æ–∑ / üöö –î–æ—Å—Ç–∞–≤–∫–∞',desc:'MacBook Air M2, 8GB, 256GB. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–ª—Å—è 6 –º–µ—Å—è—Ü–µ–≤.',contact:'@seller4',photos:[],emoji:'üíª',status:'active',pinned_until:null,views:445,created_at:n-3600000*12},
    {id:5,user_id:995,title:'AirPods Pro 2 (MQTP3)',category:'üì± –¢–µ—Ö–Ω–∏–∫–∞',price:14500,condition:'üÜï –ù–æ–≤–æ–µ',city:'–ú–æ—Å–∫–≤–∞',delivery:'üöö –î–æ—Å—Ç–∞–≤–∫–∞',desc:'AirPods Pro 2 –ø–æ–∫–æ–ª–µ–Ω–∏—è, –Ω–æ–≤—ã–µ –∑–∞–ø–µ—á–∞—Ç–∞–Ω–Ω—ã–µ.',contact:'@seller5',photos:[],emoji:'üéß',status:'active',pinned_until:null,views:203,created_at:n-3600000*8},
    {id:6,user_id:994,title:"Vintage Levi's 501 W32",category:'üëï –û–¥–µ–∂–¥–∞',price:4800,condition:'üëç –•–æ—Ä–æ—à–µ–µ',size:'32',city:'–°–ü–±',delivery:'üì¶ –ê–≤–∏—Ç–æ –¥–æ—Å—Ç–∞–≤–∫–∞ / ü§ù –°–∞–º–æ–≤—ã–≤–æ–∑',desc:"–û—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–µ Levi's 501 vintage 90-—Ö. –ë–µ–∑ –¥—ã—Ä.",contact:'@seller6',photos:[],emoji:'üëñ',status:'active',pinned_until:null,views:89,created_at:n-3600000*2},
  ];
  S.myAds=[
    {id:100,user_id:0,title:'–ú–æ–∏ AirPods Max',category:'üì± –¢–µ—Ö–Ω–∏–∫–∞',price:29000,condition:'üëç –•–æ—Ä–æ—à–µ–µ',city:'–ú–æ—Å–∫–≤–∞',delivery:'ü§ù –°–∞–º–æ–≤—ã–≤–æ–∑',desc:'–ü—Ä–æ–¥–∞—é —Å–≤–æ–∏ AirPods Max.',contact:'@me',photos:[],emoji:'üéß',status:'active',views:34,pinned_until:null,created_at:n-86400000},
    {id:101,user_id:0,title:'–°—Ç–∞—Ä—ã–µ Nike 42',category:'üëü –û–±—É–≤—å',price:1500,condition:'üôÇ –£–¥–æ–≤–ª.',size:'42',city:'–ú–æ—Å–∫–≤–∞',delivery:'ü§ù –°–∞–º–æ–≤—ã–≤–æ–∑',desc:'–°—Ç–∞—Ä—ã–µ Nike, –Ω–æ –∫—Ä–µ–ø–∫–∏–µ.',contact:'@me',photos:[],emoji:'üëü',status:'moderation',views:0,pinned_until:null,created_at:n-3600000*2},
  ];
  S.notifs=[
    {id:1,type:'info',icon:'üéâ',iconCls:'nic-acc',title:'–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å!',body:'–í—ã —É—Å–ø–µ—à–Ω–æ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–ª–∏—Å—å –≤ PuppyPost',time:n-86400000,read:true},
  ];
  S.promoCodes=[
    {code:'PUPPY20',discount:20,duration:30,max_uses:50,uses:12,active:true,created_at:n-86400000*5},
    {code:'NEWUSER',discount:15,duration:30,max_uses:100,uses:45,active:true,created_at:n-86400000*10},
  ];
  save();
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê UTILS ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function esc(s){return String(s||'').replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;')}
function fmtPrice(p){return p>0?p.toLocaleString('ru')+'‚ÇΩ':'–ë–µ—Å–ø–ª–∞—Ç–Ω–æ'}
function timeAgo(ts){
  const d=Math.floor((Date.now()-ts)/1000);
  if(d<60)return'—Ç–æ–ª—å–∫–æ —á—Ç–æ';
  if(d<3600)return Math.floor(d/60)+'–º –Ω–∞–∑–∞–¥';
  if(d<86400)return Math.floor(d/3600)+'—á –Ω–∞–∑–∞–¥';
  return Math.floor(d/86400)+'–¥ –Ω–∞–∑–∞–¥';
}
let _tt;
function toast(msg,dur=2600){
  const t=document.getElementById('toast');
  t.textContent=msg;t.classList.add('show');
  clearTimeout(_tt);_tt=setTimeout(()=>t.classList.remove('show'),dur);
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê NAVIGATION ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const SCREENS={'home':'sc-home','search':'sc-search','create':'sc-create','my-ads':'sc-my-ads','my-ad-detail':'sc-my-ad-detail','favs':'sc-favs','profile':'sc-profile','subscriptions':'sc-subscriptions','referral':'sc-referral','pin-ad':'sc-pin-ad','notifications':'sc-notifications','admin':'sc-admin','ad-detail':'sc-ad-detail'};
const NAVMAP={'home':'nav-home','search':'nav-search','create':'nav-create','my-ads':'nav-my-ads','profile':'nav-profile','my-ad-detail':'nav-my-ads','subscriptions':'nav-profile','referral':'nav-profile','pin-ad':'nav-profile','notifications':'nav-profile','admin':'nav-profile','ad-detail':null,'favs':null};

function navTo(sc){
  S.prevSc=S.curSc; S.curSc=sc;
  document.querySelectorAll('.screen').forEach(s=>s.classList.remove('active'));
  const sid=SCREENS[sc]; if(sid) document.getElementById(sid).classList.add('active');
  document.querySelectorAll('.ni').forEach(n=>n.classList.remove('active'));
  const nid=NAVMAP[sc]; if(nid) document.getElementById(nid).classList.add('active');
  window.scrollTo(0,0);
  const r={
    'home':()=>{renderHome();renderPinned();},
    'search':()=>{const inp=document.getElementById('search-inp');inp.value='';renderSearchSugg();doSearch('');setTimeout(()=>inp.focus(),200);},
    'favs':renderFavs,
    'profile':renderProfile,
    'my-ads':()=>setTab(S.curTab),
    'subscriptions':renderSubs,
    'referral':renderReferral,
    'pin-ad':renderPinAd,
    'notifications':renderNotifications,
    'admin':renderAdmin,
  };
  if(r[sc])r[sc]();
}
function navBack(){navTo(S.prevSc||'home');}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê SEARCH ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
let _st;
function doSearch(q){clearTimeout(_st);_st=setTimeout(()=>_doSearch(q),180);}
function _doSearch(q){
  q=q.trim().toLowerCase();
  if(q&&!S.searchHist.includes(q)){S.searchHist.unshift(q);S.searchHist=S.searchHist.slice(0,10);save();}
  const terms=[q,...(SYNONYMS[q]||[])];
  let res=S.ads.filter(a=>a.status==='active');
  if(q)res=res.filter(a=>terms.some(t=>(`${a.title} ${a.desc} ${a.category}`).toLowerCase().includes(t)));
  if(S.curCat)res=res.filter(a=>a.category===S.curCat);
  const now=Date.now();
  res.sort((a,b)=>{
    const ap=a.pinned_until&&a.pinned_until>now?0:1;
    const bp=b.pinned_until&&b.pinned_until>now?0:1;
    if(ap!==bp)return ap-bp;
    return b.created_at-a.created_at;
  });
  renderAdList('search-results',res);
  renderSearchSugg();
}
function renderSearchSugg(){
  const el=document.getElementById('search-sugg');if(!el)return;
  const hist=S.searchHist.slice(0,6);
  const pop=['Nike','iPhone','MacBook','–ö—É—Ä—Ç–∫–∞','–ö—Ä–æ—Å—Å–æ–≤–∫–∏','Samsung'];
  let h='';
  if(hist.length){h+=`<div class="sugg-wrap"><div class="sugg-tl">–ò—Å—Ç–æ—Ä–∏—è</div><div class="sugg-list">`;hist.forEach(t=>h+=`<button class="sugg-tag" onclick="searchTag('${esc(t)}')">üïê ${esc(t)}</button>`);h+=`</div></div>`;}
  h+=`<div class="sugg-wrap"><div class="sugg-tl">–ü–æ–ø—É–ª—è—Ä–Ω–æ–µ</div><div class="sugg-list">`;
  pop.forEach(t=>h+=`<button class="sugg-tag" onclick="searchTag('${t}')">üî• ${t}</button>`);
  h+=`</div></div>`;
  el.innerHTML=h;
}
function searchTag(t){document.getElementById('search-inp').value=t;doSearch(t);}
function filterCat(cat,el){
  S.curCat=cat;
  const cats=el.closest('.csc');
  if(cats)cats.querySelectorAll('.cc').forEach(c=>c.classList.remove('active'));
  el.classList.add('active');
  if(S.curSc==='home'){renderHome();renderPinned();}
  else if(S.curSc==='search')doSearch(document.getElementById('search-inp')?.value||'');
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê HOME ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function renderHome(){
  const now=Date.now();
  let ads=S.ads.filter(a=>a.status==='active');
  if(S.curCat)ads=ads.filter(a=>a.category===S.curCat);
  ads.sort((a,b)=>{const ap=a.pinned_until&&a.pinned_until>now?0:1,bp=b.pinned_until&&b.pinned_until>now?0:1;if(ap!==bp)return ap-bp;return b.created_at-a.created_at;});
  document.getElementById('ads-count').textContent=ads.length+' –æ–±—ä—è–≤–ª–µ–Ω–∏–π';
  renderAdList('ads-list',ads);
}
function renderPinned(){
  const now=Date.now(),pinned=S.ads.filter(a=>a.status==='active'&&a.pinned_until&&a.pinned_until>now);
  const el=document.getElementById('pinned-list'),sec=document.getElementById('pinned-section');
  if(!pinned.length){sec.style.display='none';return;}
  sec.style.display='block';
  el.innerHTML=pinned.map(a=>`<div class="hac" onclick="openAd(${a.id})"><div class="hai">${a.photos&&a.photos.length?`<img src="${esc(a.photos[0])}" loading="lazy">`:`${a.emoji||'üì¶'}`}</div><div class="hab"><div class="hat">${esc(a.title)}</div><div class="hap">${fmtPrice(a.price)}</div><div style="font-size:10px;font-weight:700;color:var(--gr)">${esc(a.city||'')}</div></div></div>`).join('');
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê AD LIST ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function renderAdList(cid,ads){
  const el=document.getElementById(cid);if(!el)return;
  if(!ads.length){el.innerHTML=`<div class="empty"><span class="ei">üîç</span><div class="et">–ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ</div><div class="es">–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –¥—Ä—É–≥—É—é –∫–∞—Ç–µ–≥–æ—Ä–∏—é –∏–ª–∏ –∑–∞–ø—Ä–æ—Å</div></div>`;return;}
  const now=Date.now();
  el.innerHTML=ads.map(a=>{
    const isPinned=a.pinned_until&&a.pinned_until>now;
    const isNew=(now-a.created_at)<3600000*12;
    return `<div class="acard" onclick="openAd(${a.id})"><div class="aimg">${a.photos&&a.photos.length?`<img src="${esc(a.photos[0])}" loading="lazy">`:`<span>${a.emoji||'üì¶'}</span>`}${isPinned?'<div class="pinb">‚≠ê –ó–∞–∫—Ä–µ–ø</div>':''}${isNew&&!isPinned?'<div class="newb">–ù–û–í–û–ï</div>':''}</div><div class="ab"><div class="acat">${esc(a.category)}</div><div class="atl">${esc(a.title)}</div><div class="ame"><div class="apr">${fmtPrice(a.price)}</div><div class="ain">üëÅ ${a.views||0}</div></div><div class="ata">${a.condition?`<div class="tag">${esc(a.condition)}</div>`:''}${a.city?`<div class="tag">üìç ${esc(a.city)}</div>`:''}${a.delivery?`<div class="tag">${esc(a.delivery.split('/')[0].trim())}</div>`:''}</div></div></div>`;
  }).join('');
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê AD DETAIL ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function openAd(id){
  const ad=[...S.ads,...S.myAds].find(a=>a.id===id);if(!ad)return;
  ad.views=(ad.views||0)+1;save();
  S.curAdId=id;S.prevSc=S.curSc;
  document.querySelectorAll('.screen').forEach(s=>s.classList.remove('active'));
  document.getElementById('sc-ad-detail').classList.add('active');
  S.curSc='ad-detail';
  document.querySelectorAll('.ni').forEach(n=>n.classList.remove('active'));
  const slider=document.getElementById('ad-slider');
  if(ad.photos&&ad.photos.length){
    slider.innerHTML=`<img src="${esc(ad.photos[0])}" style="width:100%;height:100%;object-fit:cover">`+(ad.photos.length>1?`<div class="asl-nav">${ad.photos.map((_,i)=>`<div class="asl-dot ${i===0?'active':''}"></div>`).join('')}</div>`:'');
  } else {
    slider.innerHTML=`<span style="font-size:74px">${ad.emoji||'üì¶'}</span>`;
  }
  document.getElementById('ad-hdr').textContent=ad.title;
  document.getElementById('ad-det-price').textContent=fmtPrice(ad.price);
  document.getElementById('ad-det-title').textContent=ad.title;
  const rows=[
    {icon:'üè∑Ô∏è',l:'–ö–∞—Ç–µ–≥–æ—Ä–∏—è',v:ad.category},
    {icon:'‚ú®',l:'–°–æ—Å—Ç–æ—è–Ω–∏–µ',v:ad.condition},
    ad.size?{icon:'üìè',l:'–†–∞–∑–º–µ—Ä',v:ad.size}:null,
    ad.city?{icon:'üìç',l:'–ì–æ—Ä–æ–¥',v:ad.city}:null,
    ad.delivery?{icon:'üöö',l:'–î–æ—Å—Ç–∞–≤–∫–∞',v:ad.delivery}:null,
    {icon:'üëÅ',l:'–ü—Ä–æ—Å–º–æ—Ç—Ä—ã',v:ad.views||0},
    ad.desc?{icon:'üìù',l:'–û–ø–∏—Å–∞–Ω–∏–µ',v:ad.desc}:null,
    {icon:'üìû',l:'–ö–æ–Ω—Ç–∞–∫—Ç',v:ad.contact},
  ].filter(Boolean);
  document.getElementById('ad-det-rows').innerHTML=rows.map(r=>`<div class="adr"><div class="adri">${r.icon}</div><div><div class="adrk">${r.l}</div><div class="adrt">${esc(String(r.v))}</div></div></div>`).join('');
  updateFavBtn();window.scrollTo(0,0);
}
function contactSeller(){
  const ad=[...S.ads,...S.myAds].find(a=>a.id===S.curAdId);if(!ad)return;
  const c=ad.contact||'';
  if(c.startsWith('@')&&window.Telegram?.WebApp)window.Telegram.WebApp.openTelegramLink(`https://t.me/${c.slice(1)}`);
  else if(window.Telegram?.WebApp)window.Telegram.WebApp.openLink(`tel:${c}`);
  else toast(`–ö–æ–Ω—Ç–∞–∫—Ç: ${c}`);
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê FAVS ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function toggleFav(){
  if(!S.curAdId)return;
  const idx=S.favs.indexOf(S.curAdId);
  if(idx>=0){S.favs.splice(idx,1);toast('–£–¥–∞–ª–µ–Ω–æ –∏–∑ –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ');}
  else{S.favs.push(S.curAdId);toast('–î–æ–±–∞–≤–ª–µ–Ω–æ –≤ –∏–∑–±—Ä–∞–Ω–Ω–æ–µ ‚ù§Ô∏è');}
  save();updateFavBtn();
}
function updateFavBtn(){
  const f=S.favs.includes(S.curAdId);
  const h=document.getElementById('fav-hbtn'),fab=document.getElementById('fav-fab');
  if(h)h.style.color=f?'var(--acc)':'var(--gr)';
  if(fab)fab.classList.toggle('faved',f);
}
function renderFavs(){
  const favAds=S.ads.filter(a=>S.favs.includes(a.id));
  if(!favAds.length){document.getElementById('favs-list').innerHTML=`<div class="empty"><span class="ei">‚ù§Ô∏è</span><div class="et">–ù–µ—Ç –∏–∑–±—Ä–∞–Ω–Ω—ã—Ö</div><div class="es">–ù–∞–∂–º–∏—Ç–µ ‚ù§Ô∏è –Ω–∞ –æ–±—ä—è–≤–ª–µ–Ω–∏–∏</div></div>`;return;}
  renderAdList('favs-list',favAds);
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê MY ADS ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function setTab(tab,el){
  S.curTab=tab;
  document.querySelectorAll('.tb').forEach(t=>t.classList.remove('active'));
  if(el)el.classList.add('active');
  else{const m={active:'tab-active',moderation:'tab-moderation',archive:'tab-archive'};const b=document.getElementById(m[tab]);if(b)b.classList.add('active');}
  const ads=S.myAds.filter(a=>tab==='archive'?a.status==='inactive'||a.status==='rejected':a.status===(tab==='active'?'active':'moderation'));
  const el2=document.getElementById('my-ads-list');
  if(!ads.length){
    const em={active:['üìù','–ù–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö','–°–æ–∑–¥–∞–π—Ç–µ –ø–µ—Ä–≤–æ–µ!'],moderation:['‚è≥','–ù–∞ –º–æ–¥–µ—Ä–∞—Ü–∏–∏ –Ω–µ—Ç','–°–æ–∑–¥–∞–π—Ç–µ –æ–±—ä—è–≤–ª–µ–Ω–∏–µ'],archive:['üì¶','–ê—Ä—Ö–∏–≤ –ø—É—Å—Ç','–î–µ–∞–∫—Ç–∏–≤–∏—Ä—É–π—Ç–µ –æ–±—ä—è–≤–ª–µ–Ω–∏–µ']};
    const [ic,tl,sb]=em[tab]||['üìã','–ü—É—Å—Ç–æ',''];
    el2.innerHTML=`<div class="empty"><span class="ei">${ic}</span><div class="et">${tl}</div><div class="es">${sb}</div></div>`;return;
  }
  const smap={active:'s-act',moderation:'s-mod',inactive:'s-ina',rejected:'s-rej'};
  const slb={active:'‚úÖ –ê–∫—Ç–∏–≤–Ω–æ',moderation:'‚è≥ –ú–æ–¥–µ—Ä–∞—Ü–∏—è',inactive:'üì¶ –ê—Ä—Ö–∏–≤',rejected:'‚ùå –û—Ç–∫–ª–æ–Ω–µ–Ω–æ'};
  el2.innerHTML=ads.map(a=>`<div class="mac" onclick="openMyAd(${a.id})"><div class="mat">${a.photos&&a.photos.length?`<img src="${esc(a.photos[0])}">`:a.emoji||'üì¶'}</div><div class="mai"><div class="matl">${esc(a.title)}</div><div class="map">${fmtPrice(a.price)}</div><div class="mas ${smap[a.status]||'s-ina'}">${slb[a.status]||a.status}</div><div class="mav">üëÅ ${a.views||0} ¬∑ ${timeAgo(a.created_at)}</div></div></div>`).join('');
}
function openMyAd(id){
  const ad=S.myAds.find(a=>a.id===id);if(!ad)return;
  S.actionAdId=id;S.prevSc=S.curSc;navTo('my-ad-detail');
  document.getElementById('my-ad-hdr').textContent=ad.title;
  const slb={active:'‚úÖ –ê–∫—Ç–∏–≤–Ω–æ',moderation:'‚è≥ –ù–∞ –º–æ–¥–µ—Ä–∞—Ü–∏–∏',inactive:'üì¶ –í –∞—Ä—Ö–∏–≤–µ',rejected:'‚ùå –û—Ç–∫–ª–æ–Ω–µ–Ω–æ'};
  const body=document.getElementById('my-ad-detail-body');
  body.innerHTML=`
    <div class="acard" style="margin-bottom:18px">
      <div class="aimg">${ad.photos&&ad.photos.length?`<img src="${esc(ad.photos[0])}">`:`<span style="font-size:54px">${ad.emoji||'üì¶'}</span>`}</div>
      <div class="ab"><div class="acat">${esc(ad.category)}</div><div class="atl">${esc(ad.title)}</div><div class="apr">${fmtPrice(ad.price)}</div>
        <div class="ata"><div class="tag">${slb[ad.status]||ad.status}</div>${ad.city?`<div class="tag">üìç ${esc(ad.city)}</div>`:''}<div class="tag">üëÅ ${ad.views||0}</div></div>
      </div>
    </div>
    ${ad.status==='rejected'&&ad.reject_reason?`<div class="card" style="margin-bottom:14px;border-left:3px solid var(--rd)"><div style="font-size:12px;font-weight:800;color:var(--rd);margin-bottom:4px">–ü—Ä–∏—á–∏–Ω–∞ –æ—Ç–∫–∞–∑–∞</div><div style="font-size:13px;font-weight:600;color:var(--dk)">${esc(ad.reject_reason)}</div></div>`:''}
    ${ad.status==='active'?`
      <button class="btn ba" style="margin-bottom:10px" onclick="pinMyAd(${id})">‚≠ê –ó–∞–∫—Ä–µ–ø–∏—Ç—å –æ–±—ä—è–≤–ª–µ–Ω–∏–µ</button>
      <button class="btn bn" style="margin-bottom:10px" onclick="deactivateAd(${id})">üì¶ –ü–µ—Ä–µ–Ω–µ—Å—Ç–∏ –≤ –∞—Ä—Ö–∏–≤</button>
      <button class="btn" style="background:rgba(244,67,54,.1);color:var(--rd);box-shadow:none" onclick="deleteAd(${id})">üóë –£–¥–∞–ª–∏—Ç—å</button>`:''}
    ${ad.status==='inactive'||ad.status==='rejected'?`
      <button class="btn ba" style="margin-bottom:10px" onclick="reactivateAd(${id})">üîÑ –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å</button>
      <button class="btn" style="background:rgba(244,67,54,.1);color:var(--rd);box-shadow:none" onclick="deleteAd(${id})">üóë –£–¥–∞–ª–∏—Ç—å</button>`:''}
    ${ad.status==='moderation'?`<div class="card" style="text-align:center"><div style="font-size:40px">‚è≥</div><div style="font-size:15px;font-weight:800;margin-top:10px">–û–±—ä—è–≤–ª–µ–Ω–∏–µ –Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–µ</div><div style="font-size:13px;font-weight:600;color:var(--gr);margin-top:4px">–û–±—ã—á–Ω–æ –∑–∞–Ω–∏–º–∞–µ—Ç 1‚Äì2 —á–∞—Å–∞</div></div>`:''}
  `;
}
function pinMyAd(id){
  const t=TARIFFS[S.user.tariff];
  if(!t||t.pins===0){toast('–ó–∞–∫—Ä–µ–ø –¥–æ—Å—Ç—É–ø–µ–Ω —Ç–æ–ª—å–∫–æ –ø–æ –ø–æ–¥–ø–∏—Å–∫–µ');setTimeout(()=>navTo('subscriptions'),800);return;}
  if((S.user.pins_used||0)>=t.pins){toast(`–õ–∏–º–∏—Ç –∑–∞–∫—Ä–µ–ø–æ–≤ –∏—Å—á–µ—Ä–ø–∞–Ω (${t.pins}/–º–µ—Å)`);return;}
  const ad=S.myAds.find(a=>a.id===id);
  if(ad){ad.pinned_until=Date.now()+t.pin_hours*3600000;S.user.pins_used=(S.user.pins_used||0)+1;
    const pub=S.ads.find(a=>a.id===id);if(pub)pub.pinned_until=ad.pinned_until;
    save();toast(`‚≠ê –ó–∞–∫—Ä–µ–ø–ª–µ–Ω–æ –Ω–∞ ${t.pin_hours}—á!`);addNotif('gn','‚≠ê','–û–±—ä—è–≤–ª–µ–Ω–∏–µ –∑–∞–∫—Ä–µ–ø–ª–µ–Ω–æ!',`"${ad.title}" —Ç–µ–ø–µ—Ä—å –≤ —Ç–æ–ø–µ ${t.pin_hours}—á`);navBack();}
}
function deactivateAd(id){const ad=S.myAds.find(a=>a.id===id);if(ad){ad.status='inactive';save();toast('–ü–µ—Ä–µ–Ω–µ—Å–µ–Ω–æ –≤ –∞—Ä—Ö–∏–≤');navBack();setTab('archive');}}
function reactivateAd(id){
  const ad=S.myAds.find(a=>a.id===id);
  if(ad){ad.status='moderation';save();toast('–û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –Ω–∞ –º–æ–¥–µ—Ä–∞—Ü–∏—é');addNotif('yl','‚è≥','–ù–∞ –º–æ–¥–µ—Ä–∞—Ü–∏–∏',`"${ad.title}" –∂–¥—ë—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏`);navBack();setTab('moderation');}
}
function deleteAd(id){
  if(!confirm('–£–¥–∞–ª–∏—Ç—å –æ–±—ä—è–≤–ª–µ–Ω–∏–µ?'))return;
  S.myAds=S.myAds.filter(a=>a.id!==id);S.ads=S.ads.filter(a=>a.id!==id);
  save();toast('–£–¥–∞–ª–µ–Ω–æ');navBack();setTab('active');
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê CREATE AD ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function canPostAd(){
  const now=new Date().toDateString();
  if(S.user.last_daily_reset!==now){S.user.daily_ads=0;S.user.last_daily_reset=now;}
  const lim=TARIFFS[S.user.tariff||'Free'].daily_ads;
  if(S.user.daily_ads>=lim){toast(`–õ–∏–º–∏—Ç –æ–±—ä—è–≤–ª–µ–Ω–∏–π –≤ –¥–µ–Ω—å: ${lim}`);return false;}
  return true;
}
function initCreate(){
  if(!canPostAd())return;
  S.createStep=0;S.newAd={};S.photos=[];S.deliveries=[];
  document.querySelectorAll('.fst').forEach(s=>s.classList.remove('active'));
  document.getElementById('step-0').classList.add('active');
  document.querySelectorAll('.cbtn').forEach(b=>b.classList.remove('sel'));
  document.querySelectorAll('.ch').forEach(c=>c.classList.remove('active'));
  ['ad-title','ad-desc','ad-size','ad-city','ad-contact'].forEach(id=>{const e=document.getElementById(id);if(e)e.value='';});
  const p=document.getElementById('ad-price');if(p)p.value='';
  renderPhotoGrid();updateStepi();
}
function updateStepi(){
  document.getElementById('stepi').innerHTML=Array.from({length:4},(_,i)=>`<div class="sdt ${i<S.createStep?'done':''}"></div>`).join('');
}
function selCat(cat,el){
  document.querySelectorAll('.cbtn').forEach(b=>b.classList.remove('sel'));
  el.classList.add('sel');S.newAd.category=cat;
  const hasSz=cat.includes('–û–¥–µ–∂–¥–∞')||cat.includes('–û–±—É–≤—å');
  document.getElementById('size-gr').style.display=hasSz?'block':'none';
  setTimeout(()=>nextStep(),280);
}
function selChip(el,field,val){el.parentElement.querySelectorAll('.ch').forEach(c=>c.classList.remove('active'));el.classList.add('active');S.newAd[field]=val;}
function togDeliv(el,val){el.classList.toggle('active');if(el.classList.contains('active'))S.deliveries.push(val);else S.deliveries=S.deliveries.filter(d=>d!==val);}
function nextStep(){
  if(S.createStep===1){
    if(!document.getElementById('ad-title').value.trim()){toast('–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞');return;}
    if(!S.newAd.condition){toast('–í—ã–±–µ—Ä–∏—Ç–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞');return;}
    S.newAd.title=document.getElementById('ad-title').value.trim();
    S.newAd.size=document.getElementById('ad-size').value.trim();
    S.newAd.desc=document.getElementById('ad-desc').value.trim();
  }
  if(S.createStep===2){
    const priceEl=document.getElementById('ad-price');
    S.newAd.price=priceEl.value?parseInt(priceEl.value):0;
    S.newAd.city=document.getElementById('ad-city').value.trim();
    S.newAd.delivery=S.deliveries.join(' / ');
  }
  if(S.createStep===4){renderCreatePreview();}
  document.getElementById(`step-${S.createStep}`).classList.remove('active');
  S.createStep++;
  document.getElementById(`step-${S.createStep}`).classList.add('active');
  updateStepi();window.scrollTo(0,0);
}
function backCreate(){
  if(S.createStep>0){
    document.getElementById(`step-${S.createStep}`).classList.remove('active');
    S.createStep--;
    document.getElementById(`step-${S.createStep}`).classList.add('active');
    updateStepi();
  } else {navTo('home');}
}
function renderPhotoGrid(){
  const g=document.getElementById('photo-grid');if(!g)return;
  let h=S.photos.map((p,i)=>`<div class="psl"><img src="${p}"><div class="rmv" onclick="removePhoto(${i})">‚úï</div></div>`).join('');
  if(S.photos.length<10)h+=`<div class="padd" onclick="document.getElementById('photo-file').click()">üì∑</div>`;
  g.innerHTML=h;
}
function removePhoto(i){S.photos.splice(i,1);renderPhotoGrid();}
function handlePhotos(inp){
  const files=Array.from(inp.files),rem=10-S.photos.length;
  files.slice(0,rem).forEach(f=>{const r=new FileReader();r.onload=e=>{S.photos.push(e.target.result);renderPhotoGrid();};r.readAsDataURL(f);});
  if(files.length>rem)toast(`–ú–∞–∫—Å. 10 —Ñ–æ—Ç–æ. –î–æ–±–∞–≤–ª–µ–Ω–æ ${rem}`);
  inp.value='';
}
function renderCreatePreview(){
  const p=document.getElementById('create-preview');if(!p)return;
  p.innerHTML=`<div class="card"><div style="font-size:13px;font-weight:800;color:var(--gr);margin-bottom:10px">–ü–†–ï–î–ü–†–û–°–ú–û–¢–†</div>
    <div style="font-size:11px;font-weight:800;color:var(--acc)">${esc(S.newAd.category||'')}</div>
    <div style="font-size:16px;font-weight:800;margin:4px 0">${esc(S.newAd.title||'')}</div>
    <div style="font-size:20px;font-weight:900;color:var(--acc)">${fmtPrice(S.newAd.price||0)}</div>
    <div style="font-size:13px;color:var(--gr);margin-top:6px">${esc(S.newAd.condition||'')} ${S.newAd.city?'¬∑ '+S.newAd.city:''}</div>
  </div>`;
}
function submitAd(){
  S.newAd.contact=document.getElementById('ad-contact').value.trim();
  if(!S.newAd.contact){toast('–í–≤–µ–¥–∏—Ç–µ –∫–æ–Ω—Ç–∞–∫—Ç –¥–ª—è —Å–≤—è–∑–∏');return;}
  S.newAd.photos=S.photos;
  const newAd={
    id:Date.now(),user_id:S.user.tg_id||0,
    title:S.newAd.title||'–ù–æ–≤–æ–µ',price:S.newAd.price||0,
    category:S.newAd.category||'üéÅ –î—Ä—É–≥–æ–µ',
    condition:S.newAd.condition||'',size:S.newAd.size||'',
    city:S.newAd.city||'',delivery:S.newAd.delivery||'',
    desc:S.newAd.desc||'',contact:S.newAd.contact,
    photos:S.photos.slice(),emoji:'üì¶',
    status:'moderation',views:0,
    pinned_until:null,created_at:Date.now()
  };
  
  // ‚úÖ –ò–ù–¢–ï–ì–†–ê–¶–ò–Ø: –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –æ–±—ä—è–≤–ª–µ–Ω–∏–µ –±–æ—Ç—É
  if(window.Telegram?.WebApp){
    try{
      window.Telegram.WebApp.sendData(JSON.stringify({
        action:'create_ad',
        ad_data:{
          title:newAd.title,
          price:newAd.price,
          category:newAd.category,
          description:newAd.desc,
          condition:newAd.condition,
          size:newAd.size,
          city:newAd.city,
          delivery:newAd.delivery,
          photos:newAd.photos,
          contact_info:newAd.contact
        }
      }));
      console.log('‚úÖ –û–±—ä—è–≤–ª–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –±–æ—Ç—É');
    }catch(e){
      console.error('–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –±–æ—Ç—É:',e);
    }
  }
  
  S.myAds.unshift(newAd);
  S.user.daily_ads=(S.user.daily_ads||0)+1;
  save();
  // Simulate posting to channel
  simulateChannelPost(newAd);
  addNotif('yl','‚è≥','–û–±—ä—è–≤–ª–µ–Ω–∏–µ –Ω–∞ –º–æ–¥–µ—Ä–∞—Ü–∏–∏',`"${newAd.title}" –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫—É`);
  toast('–û–±—ä—è–≤–ª–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –Ω–∞ –º–æ–¥–µ—Ä–∞—Ü–∏—é!');
  setTimeout(()=>{navTo('my-ads');setTab('moderation');},1100);
}
function simulateChannelPost(ad){
  // In prod: call bot API to post to channel
  // Simulated: after 3s auto-approve for demo
  setTimeout(()=>{
    const a=S.myAds.find(x=>x.id===ad.id);
    if(a&&a.status==='moderation'){
      a.status='active';
      S.ads.unshift({...a});
      save();
      addNotif('gn','‚úÖ','–û–±—ä—è–≤–ª–µ–Ω–∏–µ –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–æ!',`"${a.title}" –ø–æ—è–≤–∏–ª–æ—Å—å –≤ –ª–µ–Ω—Ç–µ`);
      showPushNotif('gn','‚úÖ','–û–±—ä—è–≤–ª–µ–Ω–∏–µ –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–æ!',`"${a.title}" –ø–æ—è–≤–∏–ª–æ—Å—å –≤ –ª–µ–Ω—Ç–µ`);
      updateNavBadge();
    }
  },4000);
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê PROFILE ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function renderProfile(){
  document.getElementById('prof-name').textContent=S.user.name;
  document.getElementById('prof-sub').textContent=`–¢–∞—Ä–∏—Ñ: ${S.user.tariff}${S.user.tariff_end?` ¬∑ –¥–æ ${new Date(S.user.tariff_end).toLocaleDateString('ru')}`:' (–±–µ—Å–ø–ª–∞—Ç–Ω—ã–π)'}`;
  document.getElementById('prof-tariff').textContent=S.user.tariff;
  document.getElementById('prof-ads').textContent=S.myAds.filter(a=>a.status==='active').length;
  document.getElementById('prof-views').textContent=S.myAds.reduce((s,a)=>s+(a.views||0),0);
  document.getElementById('ref-bal-prof').textContent=(S.user.ref_balance||0)+'‚ÇΩ';
  const unread=S.notifs.filter(n=>!n.read).length;
  document.getElementById('notif-count-prof').textContent=unread?unread+' –Ω–æ–≤—ã—Ö':'';
  if(S.user.tg_id)document.getElementById('prof-id').textContent='ID: '+S.user.tg_id;
  const isAdmin=ADMIN_IDS.includes(S.user.tg_id);
  document.getElementById('admin-row').style.display=isAdmin?'flex':'none';
  document.getElementById('admin-sep').style.display=isAdmin?'block':'none';
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê SUBSCRIPTIONS ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function renderSubs(){
  const disc=S.promoDiscount;
  document.getElementById('std-price').innerHTML=disc?`<s style="font-size:20px;opacity:.5">299‚ÇΩ</s> ${Math.round(299*(1-disc/100))}‚ÇΩ <span>/–º–µ—Å</span>`:`299‚ÇΩ <span>/–º–µ—Å</span>`;
  document.getElementById('pro-price').innerHTML=disc?`<s style="font-size:20px;opacity:.8">899‚ÇΩ</s> ${Math.round(899*(1-disc/100))}‚ÇΩ <span>/–º–µ—Å</span>`:`899‚ÇΩ <span>/–º–µ—Å</span>`;
}
function applyPromo(){
  const code=document.getElementById('promo-inp').value.trim().toUpperCase();
  const promo=S.promoCodes.find(p=>p.code===code&&p.active&&p.uses<p.max_uses);
  if(!promo){toast('–ü—Ä–æ–º–æ–∫–æ–¥ –Ω–µ –Ω–∞–π–¥–µ–Ω –∏–ª–∏ –∏—Å—Ç—ë–∫');return;}
  S.promoDiscount=promo.discount;S.promoCode=code;
  promo.uses++;save();
  document.getElementById('promo-applied').style.display='block';
  document.getElementById('promo-applied').innerHTML=`<div style="background:rgba(156,39,176,.1);border-radius:var(--rs);padding:10px 14px;font-size:13px;font-weight:700;color:var(--pu)">üéâ –ü—Ä–æ–º–æ–∫–æ–¥ <b>${code}</b> –ø—Ä–∏–º–µ–Ω—ë–Ω ‚Äî —Å–∫–∏–¥–∫–∞ ${promo.discount}%!</div>`;
  renderSubs();toast(`–ü—Ä–æ–º–æ–∫–æ–¥ –ø—Ä–∏–º–µ–Ω—ë–Ω! –°–∫–∏–¥–∫–∞ ${promo.discount}%`);
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê PAYMENT MODAL ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function openPayment(tariff){
  S.selPayTariff=tariff;S.selPayMethod='';
  const prices={Standard:299,PRO:899};
  const basePrice=prices[tariff]||0;
  const disc=S.promoDiscount;
  const finalPrice=disc?Math.round(basePrice*(1-disc/100)):basePrice;
  const html=`
    <button class="mclose" onclick="closeModal()">‚úï</button>
    <div style="font-size:18px;font-weight:900;color:var(--dk);margin-bottom:6px;padding-right:40px">–û–ø–ª–∞—Ç–∞ —Ç–∞—Ä–∏—Ñ–∞ ${tariff}</div>
    <div style="font-size:13px;font-weight:600;color:var(--gr);margin-bottom:18px">–°—É–º–º–∞: <b style="color:var(--acc);font-size:16px">${finalPrice}‚ÇΩ</b>${disc?` <s style="opacity:.5">${basePrice}‚ÇΩ</s> (‚àí${disc}%)`:''}</div>
    <div style="font-size:12px;font-weight:800;color:var(--gr);text-transform:uppercase;letter-spacing:.4px;margin-bottom:12px">–°–ø–æ—Å–æ–± –æ–ø–ª–∞—Ç—ã</div>
    <div class="pm" onclick="selPayMethod('yoomoney',this)">
      <div class="pmic" style="background:linear-gradient(135deg,#8B5CF6,#6D28D9)">üíú</div>
      <div><div class="pmt">–ÆMoney</div><div class="pmst">–ú–≥–Ω–æ–≤–µ–Ω–Ω–æ</div></div>
    </div>
    <div class="pm" onclick="selPayMethod('crypto',this)">
      <div class="pmic" style="background:linear-gradient(135deg,#F59E0B,#D97706)">‚Çø</div>
      <div><div class="pmt">–ö—Ä–∏–ø—Ç–æ (USDT)</div><div class="pmst">—á–µ—Ä–µ–∑ @wallet</div></div>
    </div>
    <div class="pm" onclick="selPayMethod('tinkoff',this)">
      <div class="pmic" style="background:linear-gradient(135deg,#FBBF24,#F59E0B)">üè¶</div>
      <div><div class="pmt">–¢–∏–Ω—å–∫–æ—Ñ—Ñ</div><div class="pmst">–ù–æ–º–µ—Ä –∫–∞—Ä—Ç—ã: ${PAYMENT.tinkoff}</div></div>
    </div>
    <div style="margin-top:18px">
      <button class="btn ba" id="pay-confirm-btn" onclick="confirmPayStep()" style="display:none">–ü–µ—Ä–µ–π—Ç–∏ –∫ –æ–ø–ª–∞—Ç–µ ‚Üí</button>
    </div>
    <div style="font-size:12px;font-weight:600;color:var(--lg);text-align:center;margin-top:12px">–ü–æ—Å–ª–µ –æ–ø–ª–∞—Ç—ã –ø—Ä–∏—à–ª–∏—Ç–µ —á–µ–∫ –≤ @${BOT}</div>
  `;
  showModal(html);
}
function selPayMethod(method,el){
  S.selPayMethod=method;
  document.querySelectorAll('.pm').forEach(p=>p.classList.remove('sel'));
  el.classList.add('sel');
  document.getElementById('pay-confirm-btn').style.display='flex';
}
function confirmPayStep(){
  if(!S.selPayMethod){toast('–í—ã–±–µ—Ä–∏—Ç–µ —Å–ø–æ—Å–æ–± –æ–ø–ª–∞—Ç—ã');return;}
  const t=S.selPayTariff,m=S.selPayMethod;
  const links={yoomoney:PAYMENT.yoomoney,crypto:t==='Standard'?PAYMENT.crypto_std:PAYMENT.crypto_pro,tinkoff:null};
  const link=links[m];
  if(link&&window.Telegram?.WebApp)window.Telegram.WebApp.openLink(link);
  else if(link)window.open(link,'_blank');
  
  // ‚úÖ –ò–ù–¢–ï–ì–†–ê–¶–ò–Ø: –°–æ—Ö—Ä–∞–Ω—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø–ª–∞—Ç–µ–∂–µ
  const paymentInfo={
    id:Date.now(),
    tariff:t,
    method:m,
    amount:Math.round((t==='PRO'?899:299)*(1-S.promoDiscount/100)),
    promocode:S.promoCode||null,
    discount:S.promoDiscount||0,
    status:'pending',
    created_at:new Date().toISOString()
  };
  
  // ‚úÖ –ò–ù–¢–ï–ì–†–ê–¶–ò–Ø: –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –±–æ—Ç—É
  if(window.Telegram?.WebApp){
    try{
      window.Telegram.WebApp.sendData(JSON.stringify({
        action:'payment_initiated',
        payment_data:paymentInfo
      }));
      console.log('‚úÖ –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–ª–∞—Ç–µ–∂–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞ –±–æ—Ç—É');
    }catch(e){
      console.error('–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –ø–ª–∞—Ç–µ–∂–∞ –±–æ—Ç—É:',e);
    }
  }
  
  // Show receipt instruction with bot redirect
  const mb=document.getElementById('modal-body');
  mb.innerHTML=`
    <button class="mclose" onclick="closeModal()">‚úï</button>
    <div style="text-align:center;padding:10px 0 20px">
      <div style="font-size:48px;margin-bottom:12px">üì∏</div>
      <div style="font-size:18px;font-weight:900;color:var(--dk);margin-bottom:8px">–û—Ç–ø—Ä–∞–≤—å—Ç–µ —á–µ–∫</div>
      <div style="font-size:14px;font-weight:600;color:var(--gr);margin-bottom:20px">–ü–æ—Å–ª–µ –æ–ø–ª–∞—Ç—ã –æ—Ç–ø—Ä–∞–≤—å—Ç–µ —Å–∫—Ä–∏–Ω—à–æ—Ç —á–µ–∫–∞ –±–æ—Ç—É @${BOT} ‚Äî –º—ã –ø—Ä–æ–≤–µ—Ä–∏–º –∏ –∞–∫—Ç–∏–≤–∏—Ä—É–µ–º —Ç–∞—Ä–∏—Ñ –≤ —Ç–µ—á–µ–Ω–∏–µ —á–∞—Å–∞</div>
      <button class="btn ba" onclick="openBotForPayment('${paymentInfo.id}')">–û—Ç–ø—Ä–∞–≤–∏—Ç—å —á–µ–∫ –≤ –±–æ—Ç ‚Üí</button>
      <button class="btn bg" style="margin-top:10px" onclick="closeModal()">–ó–∞–∫—Ä—ã—Ç—å</button>
    </div>
  `;
  // save payment record
  S.payments.push(paymentInfo);
  save();
  addNotif('yl','üí≥','–ü–ª–∞—Ç—ë–∂ –æ–∂–∏–¥–∞–µ—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è',`–û—Ç–ø—Ä–∞–≤—å—Ç–µ —á–µ–∫ –≤ @${BOT}`);
}
// ‚úÖ –ò–ù–¢–ï–ì–†–ê–¶–ò–Ø: –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–µ—Ä–µ—Ö–æ–¥–∞ –∫ –±–æ—Ç—É —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–º –ø–ª–∞—Ç–µ–∂–∞
function openBotForPayment(paymentId){
  if(window.Telegram?.WebApp){
    window.Telegram.WebApp.openTelegramLink(`https://t.me/${BOT}?start=payment_${paymentId}`);
  }else{
    window.open(`https://t.me/${BOT}?start=payment_${paymentId}`,'_blank');
  }
  closeModal();
}
function openBot(){if(window.Telegram?.WebApp)window.Telegram.WebApp.openTelegramLink(`https://t.me/${BOT}`);}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê REFERRAL ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function renderReferral(){
  document.getElementById('ref-bal').textContent=(S.user.ref_balance||0)+'‚ÇΩ';
  document.getElementById('ref-total').textContent=(S.user.ref_total||0)+'‚ÇΩ';
  document.getElementById('ref-cnt').textContent=S.referrals.length;
  document.getElementById('ref-act').textContent=S.referrals.filter(r=>r.bought).length;
  document.getElementById('ref-link').textContent=`https://t.me/${BOT}?start=ref_${S.user.tg_id||'0'}`;
  const el=document.getElementById('ref-list');
  if(!S.referrals.length){el.innerHTML=`<div class="empty" style="padding:24px"><span class="ei" style="font-size:36px">üë•</span><div class="et" style="font-size:15px">–ù–µ—Ç —Ä–µ—Ñ–µ—Ä–∞–ª–æ–≤</div><div class="es">–ü–æ–¥–µ–ª–∏—Ç–µ—Å—å —Å—Å—ã–ª–∫–æ–π!</div></div>`;return;}
  el.innerHTML=S.referrals.map(r=>`<div class="rc"><div class="rav">${r.bought?'üòä':'üò∂'}</div><div style="flex:1"><div class="rn">${esc(r.name)}</div><div class="rd-row">${r.bought?'–ö—É–ø–∏–ª –ø–æ–¥–ø–∏—Å–∫—É':'–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–ª—Å—è'}</div></div><div class="rr">${r.bought?'+'+Math.round((S.user.tariff==='PRO'?899:299)*0.05)+'‚ÇΩ':'‚Äî'}</div></div>`).join('');
}
function copyRef(){
  const link=document.getElementById('ref-link').textContent;
  navigator.clipboard?.writeText(link).then(()=>toast('–°—Å—ã–ª–∫–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞!')).catch(()=>toast(link));
}
function shareRef(){
  const link=document.getElementById('ref-link').textContent;
  if(window.Telegram?.WebApp)window.Telegram.WebApp.openTelegramLink(`https://t.me/share/url?url=${encodeURIComponent(link)}&text=${encodeURIComponent('–ü—Ä–∏—Å–æ–µ–¥–∏–Ω—è–π—Å—è –∫ PuppyPost ‚Äî –º–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å –¥–ª—è –∂–∏–≤–æ—Ç–Ω—ã—Ö! üêæ')}`);
  else toast('–°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Å—Å—ã–ª–∫—É –∏ –ø–æ–¥–µ–ª–∏—Ç–µ—Å—å –µ—é');
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê PIN AD ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function renderPinAd(){
  const t=TARIFFS[S.user.tariff||'Free'];
  const el=document.getElementById('pin-ad-list');
  const activeAds=S.myAds.filter(a=>a.status==='active');
  if(t.pins===0){el.innerHTML=`<div class="card" style="text-align:center"><div style="font-size:36px">üîí</div><div style="font-size:15px;font-weight:800;margin:10px 0 6px">–ù–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –∑–∞–∫—Ä–µ–ø–æ–≤</div><div style="font-size:13px;font-weight:600;color:var(--gr);margin-bottom:14px">–û—Ñ–æ—Ä–º–∏—Ç–µ –ø–æ–¥–ø–∏—Å–∫—É —á—Ç–æ–±—ã –∑–∞–∫—Ä–µ–ø–ª—è—Ç—å –æ–±—ä—è–≤–ª–µ–Ω–∏—è</div><button class="btn ba" onclick="navTo('subscriptions')">–°–º–æ—Ç—Ä–µ—Ç—å —Ç–∞—Ä–∏—Ñ—ã</button></div>`;return;}
  if(!activeAds.length){el.innerHTML=`<div class="empty"><span class="ei">üìù</span><div class="et">–ù–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö –æ–±—ä—è–≤–ª–µ–Ω–∏–π</div></div>`;return;}
  const used=S.user.pins_used||0;
  el.innerHTML=`<div style="background:rgba(255,87,34,.08);border-radius:var(--rs);padding:12px 14px;margin-bottom:14px;font-size:13px;font-weight:700;color:var(--acc)">–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–æ –∑–∞–∫—Ä–µ–ø–æ–≤: ${used}/${t.pins} —ç—Ç–æ—Ç –º–µ—Å—è—Ü</div>`+
  activeAds.map(a=>{
    const pinned=a.pinned_until&&a.pinned_until>Date.now();
    return `<div class="mac" onclick="${pinned?`toast('–£–∂–µ –∑–∞–∫—Ä–µ–ø–ª–µ–Ω–æ –¥–æ '+new Date(${a.pinned_until}).toLocaleDateString(\"ru\"))`:`pinMyAd(${a.id})`}">
      <div class="mat">${a.photos&&a.photos.length?`<img src="${esc(a.photos[0])}">`:(a.emoji||'üì¶')}</div>
      <div class="mai"><div class="matl">${esc(a.title)}</div><div class="map">${fmtPrice(a.price)}</div>
        <div class="mas ${pinned?'s-act':'s-ina'}">${pinned?`‚≠ê –ó–∞–∫—Ä–µ–ø –¥–æ ${new Date(a.pinned_until).toLocaleDateString('ru')}`:'–ù–µ –∑–∞–∫—Ä–µ–ø–ª–µ–Ω–æ'}</div>
      </div>
    </div>`;
  }).join('');
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê NOTIFICATIONS ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function addNotif(cls,icon,title,body){
  const n={id:Date.now()+Math.random(),iconCls:'nic-'+cls,icon,title,body,time:Date.now(),read:false};
  S.notifs.unshift(n);S.notifs=S.notifs.slice(0,50);save();updateNavBadge();
}
function renderNotifications(){
  const el=document.getElementById('notif-list');
  if(!S.notifs.length){el.innerHTML=`<div class="empty"><span class="ei">üîî</span><div class="et">–ù–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π</div></div>`;return;}
  el.innerHTML=S.notifs.map(n=>`
    <div class="notif-item ${n.read?'':'unread'}" onclick="readNotif(${n.id})">
      <div class="notif-ic ${n.iconCls||'nic-bl'}">${n.icon}</div>
      <div style="flex:1"><div class="notif-tl">${esc(n.title)}</div><div class="notif-bd" style="color:var(--gr);font-size:12px">${esc(n.body)}</div><div style="font-size:10px;font-weight:600;color:var(--lg);margin-top:3px">${timeAgo(n.time)}</div></div>
    </div>`).join('');
  // mark all as read after viewing
  setTimeout(()=>{S.notifs.forEach(n=>n.read=true);save();updateNavBadge();},1500);
}
function readNotif(id){S.notifs.forEach(n=>{if(n.id===id)n.read=true;});save();updateNavBadge();}
function markAllRead(){S.notifs.forEach(n=>n.read=true);save();updateNavBadge();renderNotifications();}
function updateNavBadge(){
  const cnt=S.notifs.filter(n=>!n.read).length;
  const dot=document.getElementById('notif-dot'),dot2=document.getElementById('notif-dot2');
  const badge=document.getElementById('nav-profile-badge');
  if(dot)dot.style.display=cnt?'block':'none';
  if(dot2)dot2.style.display=cnt?'block':'none';
  if(badge){badge.style.display=cnt?'flex':'none';badge.textContent=cnt>9?'9+':cnt;}
}
function showPushNotif(cls,icon,title,body){
  const bar=document.getElementById('notif-bar');
  const n=document.createElement('div');
  n.className='notif';
  n.innerHTML=`<div class="notif-ic nic-${cls}">${icon}</div><div><div class="notif-tl">${esc(title)}</div><div class="notif-bd">${esc(body)}</div></div>`;
  n.onclick=()=>{n.remove();navTo('notifications');};
  bar.appendChild(n);
  setTimeout(()=>{n.style.transition='all .4s ease';n.style.opacity='0';n.style.transform='translateX(110%)';setTimeout(()=>n.remove(),400);},4000);
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê ADMIN ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function renderAdmin(){
  const isAdmin=ADMIN_IDS.includes(S.user.tg_id);
  if(!isAdmin){toast('–ù–µ—Ç –¥–æ—Å—Ç—É–ø–∞');navBack();return;}
  document.getElementById('stat-users').textContent=S.referrals.length+1;
  const allAds=[...S.ads,...S.myAds.filter(a=>!S.ads.find(x=>x.id===a.id))];
  document.getElementById('stat-ads').textContent=allAds.length;
  document.getElementById('stat-active').textContent=allAds.filter(a=>a.status==='active').length;
  document.getElementById('stat-mod').textContent=allAds.filter(a=>a.status==='moderation').length;
  // Moderation queue
  const modAds=S.myAds.filter(a=>a.status==='moderation');
  const mq=document.getElementById('admin-mod-queue');
  if(!modAds.length){mq.innerHTML=`<div style="font-size:13px;font-weight:600;color:var(--gr);padding:12px 0">–ù–µ—Ç –æ–±—ä—è–≤–ª–µ–Ω–∏–π –Ω–∞ –º–æ–¥–µ—Ä–∞—Ü–∏–∏</div>`;}
  else{mq.innerHTML=modAds.map(a=>`
    <div class="mod-card"><div class="mod-img">${a.photos&&a.photos.length?`<img src="${esc(a.photos[0])}">`:`<span>${a.emoji||'üì¶'}</span>`}</div>
    <div class="mod-body"><div class="mod-title">${esc(a.title)}</div><div class="mod-meta">${fmtPrice(a.price)} ¬∑ ${esc(a.category)} ¬∑ ${esc(a.city||'‚Äî')}</div>
    <div style="display:flex;gap:8px">
      <button class="btn ba" style="flex:1;padding:11px" onclick="moderateAd(${a.id},true)">‚úÖ –û–¥–æ–±—Ä–∏—Ç—å</button>
      <button class="btn" style="flex:1;padding:11px;background:rgba(244,67,54,.1);color:var(--rd);box-shadow:none" onclick="moderateAd(${a.id},false)">‚ùå –û—Ç–∫–ª–æ–Ω–∏—Ç—å</button>
    </div></div></div>`).join('');}
  // Payments
  const pendPay=S.payments.filter(p=>p.status==='pending');
  const pl=document.getElementById('admin-payments-list');
  if(!pendPay.length){pl.innerHTML=`<div style="font-size:13px;font-weight:600;color:var(--gr);padding:12px 0">–ù–µ—Ç –æ–∂–∏–¥–∞—é—â–∏—Ö –ø–ª–∞—Ç–µ–∂–µ–π</div>`;}
  else{pl.innerHTML=pendPay.map(p=>`
    <div class="admin-card"><div style="font-size:14px;font-weight:800;margin-bottom:4px">–¢–∞—Ä–∏—Ñ ${p.tariff} ¬∑ ${p.amount}‚ÇΩ</div>
    <div style="font-size:12px;font-weight:600;color:var(--gr);margin-bottom:10px">${p.method} ¬∑ ${timeAgo(p.created_at)}${p.promo?` ¬∑ –ü—Ä–æ–º–æ–∫–æ–¥: ${p.promo}`:''}</div>
    <div style="display:flex;gap:8px">
      <button class="btn ba" style="flex:1;padding:11px" onclick="approvePayment(${p.id})">‚úÖ –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å</button>
      <button class="btn" style="flex:1;padding:11px;background:rgba(244,67,54,.1);color:var(--rd);box-shadow:none" onclick="rejectPayment(${p.id})">‚ùå –û—Ç–∫–ª–æ–Ω–∏—Ç—å</button>
    </div></div>`).join('');}
  // Promos
  const pl2=document.getElementById('promo-list-admin');
  if(!S.promoCodes.length){pl2.innerHTML=`<div style="font-size:13px;font-weight:600;color:var(--gr);padding:4px 0">–ù–µ—Ç –ø—Ä–æ–º–æ–∫–æ–¥–æ–≤</div>`;}
  else{pl2.innerHTML=S.promoCodes.map(p=>`
    <div class="admin-card" style="display:flex;align-items:center;gap:12px">
      <div style="flex:1"><div style="font-size:15px;font-weight:900;color:var(--dk)">${esc(p.code)}</div>
      <div style="font-size:12px;font-weight:600;color:var(--gr)">‚àí${p.discount}% ¬∑ ${p.uses}/${p.max_uses} –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–π</div></div>
      <div onclick="deactivatePromo('${p.code}')" style="font-size:12px;font-weight:800;color:${p.active?'var(--rd)':'var(--gr)'};cursor:pointer">${p.active?'–û—Ç–∫–ª.':'–û—Ç–∫–ª.'}</div>
    </div>`).join('');}
}
function moderateAd(id,approve){
  const ad=S.myAds.find(a=>a.id===id);if(!ad)return;
  if(approve){
    ad.status='active';
    if(!S.ads.find(x=>x.id===id))S.ads.unshift({...ad});
    addNotif('gn','‚úÖ','–û–±—ä—è–≤–ª–µ–Ω–∏–µ –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–æ!',`"${ad.title}" —Ç–µ–ø–µ—Ä—å –≤ –ª–µ–Ω—Ç–µ`);
    showPushNotif('gn','‚úÖ','–û–±—ä—è–≤–ª–µ–Ω–∏–µ –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–æ!',`"${ad.title}" —Ç–µ–ø–µ—Ä—å –≤ –ª–µ–Ω—Ç–µ`);
    toast('–û–±—ä—è–≤–ª–µ–Ω–∏–µ –æ–¥–æ–±—Ä–µ–Ω–æ');
  } else {
    const reason=prompt('–ü—Ä–∏—á–∏–Ω–∞ –æ—Ç–∫–∞–∑–∞ (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ):','–ù–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –ø—Ä–∞–≤–∏–ª–∞–º');
    ad.status='rejected';ad.reject_reason=reason||'–ù–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –ø—Ä–∞–≤–∏–ª–∞–º';
    addNotif('rd','‚ùå','–û–±—ä—è–≤–ª–µ–Ω–∏–µ –æ—Ç–∫–ª–æ–Ω–µ–Ω–æ',`"${ad.title}": ${ad.reject_reason}`);
    toast('–û–±—ä—è–≤–ª–µ–Ω–∏–µ –æ—Ç–∫–ª–æ–Ω–µ–Ω–æ');
  }
  save();renderAdmin();
}
function approvePayment(id){
  const p=S.payments.find(x=>x.id===id);if(!p)return;
  p.status='approved';p.confirmed_at=Date.now();
  S.user.tariff=p.tariff;
  S.user.tariff_end=Date.now()+30*86400000;
  S.user.pins_used=0;
  save();
  addNotif('gn','üéâ','–ü–æ–¥–ø–∏—Å–∫–∞ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–∞!',`–¢–∞—Ä–∏—Ñ ${p.tariff} –∞–∫—Ç–∏–≤–µ–Ω –¥–æ ${new Date(S.user.tariff_end).toLocaleDateString('ru')}`);
  showPushNotif('gn','üéâ','–ü–æ–¥–ø–∏—Å–∫–∞ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–∞!',`–¢–∞—Ä–∏—Ñ ${p.tariff} –∞–∫—Ç–∏–≤–µ–Ω –¥–æ ${new Date(S.user.tariff_end).toLocaleDateString('ru')}`);
  toast('–ü–ª–∞—Ç—ë–∂ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥—ë–Ω, —Ç–∞—Ä–∏—Ñ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω');
  renderAdmin();
}
function rejectPayment(id){
  const p=S.payments.find(x=>x.id===id);if(!p)return;
  p.status='rejected';save();
  addNotif('rd','‚ùå','–ü–ª–∞—Ç—ë–∂ –æ—Ç–∫–ª–æ–Ω—ë–Ω',`–¢–∞—Ä–∏—Ñ ${p.tariff}. –û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –≤ –ø–æ–¥–¥–µ—Ä–∂–∫—É`);
  toast('–ü–ª–∞—Ç—ë–∂ –æ—Ç–∫–ª–æ–Ω—ë–Ω');renderAdmin();
}
function sendBroadcast(){
  const text=document.getElementById('broadcast-text').value.trim();
  if(!text){toast('–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç —Ä–∞—Å—Å—ã–ª–∫–∏');return;}
  // Show broadcast as notification to all
  addNotif('bl','üì¢','–°–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞',text);
  showPushNotif('bl','üì¢','–†–∞—Å—Å—ã–ª–∫–∞ –æ—Ç –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞',text);
  document.getElementById('broadcast-text').value='';
  toast('–†–∞—Å—Å—ã–ª–∫–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞!');
  // In prod: send via bot to all users
  if(window.Telegram?.WebApp)window.Telegram.WebApp.sendData(JSON.stringify({action:'broadcast',text}));
}
function showPromoCreate(){
  const html=`
    <button class="mclose" onclick="closeModal()">‚úï</button>
    <div style="font-size:18px;font-weight:900;margin-bottom:18px">–°–æ–∑–¥–∞—Ç—å –ø—Ä–æ–º–æ–∫–æ–¥</div>
    <div class="fgr"><label class="flb">–ö–æ–¥ –ø—Ä–æ–º–æ–∫–æ–¥–∞</label><input class="inp" id="new-promo-code" placeholder="PUPPY20" style="text-transform:uppercase"></div>
    <div class="fgr"><label class="flb">–°–∫–∏–¥–∫–∞ (%)</label><input class="inp" id="new-promo-disc" type="number" min="5" max="80" placeholder="20"></div>
    <div class="fgr"><label class="flb">–ú–∞–∫—Å. –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–π</label><input class="inp" id="new-promo-uses" type="number" min="1" placeholder="50"></div>
    <button class="btn ba" onclick="createPromo()">–°–æ–∑–¥–∞—Ç—å</button>
  `;
  showModal(html);
}
function createPromo(){
  const code=(document.getElementById('new-promo-code').value||'').toUpperCase().trim();
  const disc=parseInt(document.getElementById('new-promo-disc').value)||0;
  const uses=parseInt(document.getElementById('new-promo-uses').value)||100;
  if(!code){toast('–í–≤–µ–¥–∏—Ç–µ –∫–æ–¥');return;}
  if(disc<5||disc>80){toast('–°–∫–∏–¥–∫–∞ 5‚Äì80%');return;}
  if(S.promoCodes.find(p=>p.code===code)){toast('–¢–∞–∫–æ–π –ø—Ä–æ–º–æ–∫–æ–¥ —É–∂–µ –µ—Å—Ç—å');return;}
  S.promoCodes.push({code,discount:disc,duration:30,max_uses:uses,uses:0,active:true,created_at:Date.now()});
  save();toast('–ü—Ä–æ–º–æ–∫–æ–¥ —Å–æ–∑–¥–∞–Ω!');closeModal();renderAdmin();
}
function deactivatePromo(code){
  const p=S.promoCodes.find(x=>x.code===code);if(p)p.active=!p.active;save();renderAdmin();
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê MODAL ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function showModal(html){
  document.getElementById('modal-body').innerHTML=html;
  document.getElementById('overlay').classList.add('show');
}
function closeModal(){document.getElementById('overlay').classList.remove('show');}
function closeOverlay(e){if(e.target===document.getElementById('overlay'))closeModal();}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê INIT ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
window.addEventListener('load',()=>{
  // ‚úÖ –ò–ù–¢–ï–ì–†–ê–¶–ò–Ø: –û–±—Ä–∞–±–æ—Ç–∫–∞ URL –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ç–∞—Ä–∏—Ñ–∞
  const urlParams=new URLSearchParams(window.location.search);
  if(urlParams.get('refresh')==='1'){
    const tariff=urlParams.get('tariff');
    const tariffEnd=urlParams.get('tariff_end');
    if(tariff){
      S.user.tariff=tariff;
      if(tariffEnd){
        S.user.tariff_end=new Date(tariffEnd).getTime();
      }else{
        S.user.tariff_end=Date.now()+30*86400000;
      }
      S.user.pins_used=0;
      save();
      toast(`üéâ –¢–∞—Ä–∏—Ñ ${tariff} –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω!`);
      console.log('‚úÖ –¢–∞—Ä–∏—Ñ –æ–±–Ω–æ–≤–ª—ë–Ω –∏–∑ URL:',tariff);
      setTimeout(()=>{
        renderProfile();
        renderSubs();
        navTo('profile');
      },800);
    }
  }
  
  // Telegram init
  if(window.Telegram?.WebApp){
    const tg=window.Telegram.WebApp;
    tg.ready();tg.expand();
    const u=tg.initDataUnsafe?.user;
    if(u){
      S.user.name=u.first_name+(u.last_name?' '+u.last_name:'');
      S.user.tg_id=u.id;
      S.user.username=u.username||'';
      console.log('‚úÖ Telegram user:',S.user.tg_id,S.user.name);
    }
  }
  initDemo();
  renderHome();renderPinned();
  updateNavBadge();
  // Simulate subscription expiry check
  if(S.user.tariff!=='Free'&&S.user.tariff_end&&Date.now()>S.user.tariff_end){
    const old=S.user.tariff;
    S.user.tariff='Free';S.user.tariff_end=null;save();
    addNotif('rd','‚è∞','–ü–æ–¥–ø–∏—Å–∫–∞ –∑–∞–∫–æ–Ω—á–∏–ª–∞—Å—å',`–¢–∞—Ä–∏—Ñ ${old} –∏—Å—Ç—ë–∫. –ü—Ä–æ–¥–ª–∏—Ç–µ –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –ø—Ä–∏–≤–∏–ª–µ–≥–∏–π.`);
    showPushNotif('rd','‚è∞','–ü–æ–¥–ø–∏—Å–∫–∞ –∑–∞–∫–æ–Ω—á–∏–ª–∞—Å—å',`–¢–∞—Ä–∏—Ñ ${old} –∏—Å—Ç—ë–∫`);
  }
});
</script>
</body>
</html>
